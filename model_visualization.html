<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Model Visualization</title>
    <style>
        /* Basic Reset */
        *, *::before, *::after {
            box-sizing: border-box;
        }
        body.dark-theme {
            background-color: #1e1e1e;
            color: #d4d4d4;
        }
        body.dark-theme .controls,
        body.dark-theme .info-panel,
        body.dark-theme .node-menu,
        body.dark-theme .help-tooltip,
        body.dark-theme .zoom-controls,
        body.dark-theme button,
        body.dark-theme input {
            background-color: #252526;
            color: #d4d4d4;
            border-color: #3c3c3c;
        }
        body.dark-theme button:hover,
        body.dark-theme .menu-item:hover {
            background-color: #3e3e3e;
        }
        body.dark-theme .zoom-button {
            background: #3775c9; /* Darker blue for dark theme */
        }
        body.dark-theme th {
            background-color: #333;
        }
        body.dark-theme td, body.dark-theme th {
            border-bottom-color: #444;
        }
        body.dark-theme .layer-path {
            background-color: #2a2a2a;
            border-color: #444;
        }
        body.dark-theme #searchInput {
            background-color: #3c3c3c;
            color: #d4d4d4;
        }
        body.dark-theme .visualization-container {
            border-color: #3c3c3c;
        }
        body.dark-theme .resize-handle {
            background-color: #252526;
            border-top-color: #3c3c3c;
        }

        body {
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 20px;
  display: flex;
  flex-direction: column;
  height: 100vh;
}
.visualization-container {
  flex: 1;
  overflow: auto;
  border: 1px solid #ccc;
  margin-bottom: 20px;
  padding: 10px;
  position: relative;
}
.info-panel {
  height: 200px;
  overflow: auto;
  border: 1px solid #ccc;
  padding: 10px;
  background-color: #f9f9f9;
}
.controls {
  margin-bottom: 10px;
  padding: 10px;
  background-color: #f0f0f0;
  border-radius: 4px;
}
.zoom-controls {
  position: absolute;
  top: 20px;
  right: 20px;
  background: white;
  border: 1px solid #ccc;
  border-radius: 4px;
  padding: 5px;
}
.zoom-button {
  cursor: pointer;
  margin: 0 5px;
  background: #4285F4;
  color: white;
  border: none;
  padding: 5px 10px;
  border-radius: 3px;
}
.copy-notification {
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  padding: 10px 20px;
  background-color: #333;
  color: white;
  border-radius: 4px;
  opacity: 0;
  transition: opacity 0.5s;
}

.copy-notification.success {
  background-color: #4CAF50; /* Green for success */
}

.copy-notification.error {
  background-color: #F44336; /* Red for error */
}

.copy-notification.info {
  background-color: #2196F3; /* Blue for info */
}

table {
  border-collapse: collapse;
  width: 100%;
}
th, td {
  padding: 8px;
  text-align: left;
  border-bottom: 1px solid #ddd;
}
th {
  background-color: #f2f2f2;
}
.highlight-node {
  stroke: #FF5722 !important;
  stroke-width: 3px !important;
}
.fade {
  opacity: 0.3;
  transition: opacity 0.3s;
}
.node-menu {
  position: absolute;
  background: white;
  border: 1px solid #ccc;
  border-radius: 4px;
  padding: 5px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  z-index: 100;
  display: none;
}
.menu-item {
  cursor: pointer;
  padding: 5px 10px;
}
.menu-item:hover {
  background-color: #f0f0f0;
}
.export-btn {
  margin-top: 10px;
  padding: 8px 16px;
  background-color: #4CAF50;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}
.export-btn:hover {
  background-color: #45a049;
}
.layer-path {
  font-family: monospace;
  padding: 5px;
  background-color: #f5f5f5;
  border: 1px solid #ddd;
  border-radius: 4px;
  margin: 5px 0;
  word-break: break-all;
}

/* New styles for collapsible nodes */
.hidden-node {
  display: none !important;
}

.collapsed-node polygon,
.collapsed-node rect {
  fill: #FFC107 !important; /* Yellow background for collapsed nodes */
}

.collapsed-node:after {
  content: "+";
  position: absolute;
  right: 5px;
  top: 50%;
  transform: translateY(-50%);
  font-weight: bold;
  font-size: 14px;
}

/* Draggable node styles */
[id^="node_"] {
  cursor: pointer;
  transition: filter 0.2s;
}

[id^="node_"]:hover {
  filter: brightness(1.05);
}

[id^="node_"].dragging {
  cursor: grabbing !important;
  filter: brightness(1.1) drop-shadow(0 2px 5px rgba(0,0,0,0.2));
}

/* Help tooltip */
.help-tooltip {
  position: fixed;
  right: 20px;
  bottom: 20px;
  background: white;
  border: 1px solid #ccc;
  border-radius: 5px;
  padding: 15px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  display: none;
  z-index: 1000;
  max-width: 300px;
}

.help-tooltip h3 {
  margin-top: 0;
  border-bottom: 1px solid #eee;
  padding-bottom: 8px;
}

.help-tooltip ul {
  margin: 0;
  padding-left: 20px;
}

.help-tooltip li {
  margin-bottom: 8px;
}

/* Improve button styles */
button {
  cursor: pointer;
  background-color: #f0f0f0;
  border: 1px solid #ccc;
  border-radius: 4px;
  padding: 5px 10px;
  margin-right: 5px;
  transition: background-color 0.2s;
}

button:hover {
  background-color: #e0e0e0;
}

/* Improved search input */
#searchInput {
  padding: 5px 10px;
  border: 1px solid #ccc;
  border-radius: 4px;
  width: 200px;
  margin-right: 5px;
}

/* Animation for transitions */
svg g {
  transition: opacity 0.3s, transform 0.1s;
}

.highlight-path-segment polygon,
.highlight-path-segment rect {
  stroke: #4CAF50 !important; /* Green for path */
  stroke-width: 2.5px !important;
  fill-opacity: 0.8 !important;
}

.highlight-path-segment text {
  font-weight: bold;
}

/* Styles for expansion indicator */
.expansion-indicator {
  font-family: monospace;
  font-size: 16px;
  fill: #333;
  cursor: pointer;
}

body.dark-theme .expansion-indicator {
  fill: #ccc;
}

/* Resizable container */
.resize-handle {
  width: 100%;
  height: 10px;
  background-color: #f0f0f0;
  cursor: ns-resize;
  border-top: 1px solid #ccc;
}

/* Ensure SVG takes full width of its container for pan/zoom to work correctly */
#svgPanZoomContainer svg {
    display: block; /* Removes extra space below inline SVGs */
    width: 100%;
    height: 100%;
    max-width: 100%; /* Ensure it doesn't overflow */
    max-height: 100%; /* Ensure it doesn't overflow */
}

.svg-pan-zoom-container {
    width: 100%;
    height: 100%;
    overflow: hidden; /* Crucial for svg-pan-zoom */
}

        /* Loading Spinner */
        .loading-spinner {
            border: 5px solid #f3f3f3; /* Light grey */
            border-top: 5px solid #3498db; /* Blue */
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1001; /* Above node menu */
        }
        body.dark-theme .loading-spinner {
            border-color: #444;
            border-top-color: #3775c9;
        }

        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }
    </style>
</head>
<body>
    <h1>Interactive Model Visualization</h1>
    <div class="controls" role="toolbar" aria-label="Visualization Controls">
        <button id="expandAll" title="Expand all nodes">Expand All</button>
        <button id="collapseAll" title="Collapse all top-level nodes">Collapse All</button>
        <input type="text" id="searchInput" placeholder="Search (e.g., name, type:Conv2d)" aria-label="Search modules">
        <button id="clearSearch" title="Clear search input">Clear</button>
        <button id="exportJSON" class="export-btn" title="Export model structure as JSON">Export JSON</button>
        <button id="themeToggle" title="Toggle light/dark theme">Toggle Theme</button>
        <button id="helpButton" title="Show help and keyboard shortcuts (?)">Help (?)</button>
    </div>

    <div class="visualization-container" id="visualizationContainer" role="application" aria-roledescription="Interactive model graph">
        <div id="loadingIndicator" class="loading-spinner" style="display: none;"></div>
        <div class="svg-pan-zoom-container" id="svgPanZoomContainer">
             <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 12.2.1 (20241206.2353)
 -->
<!-- Title: model_visualization Pages: 1 -->
<svg width="2728pt" height="298pt"
 viewBox="0.00 0.00 2728.15 298.20" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 294.2)">
<title>model_visualization</title>
<!-- node_root_model -->
<g id="node_root_model" class="node" data-name="root">
<title>node_root_model</title>
<g id="a_node_root_model"><a xlink:title="Root: CustomModel&#10;Parameters: 475,565">
<path fill="#d1e7f7" stroke="#4285f4" d="M818.85,-260.9C818.85,-260.9 920.55,-260.9 920.55,-260.9 925.35,-260.9 930.15,-265.7 930.15,-270.5 930.15,-270.5 930.15,-280.1 930.15,-280.1 930.15,-284.9 925.35,-289.7 920.55,-289.7 920.55,-289.7 818.85,-289.7 818.85,-289.7 814.05,-289.7 809.25,-284.9 809.25,-280.1 809.25,-280.1 809.25,-270.5 809.25,-270.5 809.25,-265.7 814.05,-260.9 818.85,-260.9" data-name="root"/>
<text text-anchor="middle" x="869.7" y="-271.6" font-family="Arial, Helvetica, sans-serif" font-size="11.00" data-name="root">model (CustomModel)</text>
</a>
</g>
</g>
<!-- node_attention -->
<g id="node_attention" class="node" data-name="attention">
<title>node_attention</title>
<g id="a_node_attention"><a xlink:title="Name: attention&#10;Type: MultiheadAttention&#10;Parameters: 66,048&#10;Trainable: Yes">
<path fill="#e5f5fd" stroke="#4285f4" d="M329.8,-202.4C329.8,-202.4 193.6,-202.4 193.6,-202.4 188.8,-202.4 184,-197.6 184,-192.8 184,-192.8 184,-183.2 184,-183.2 184,-178.4 188.8,-173.6 193.6,-173.6 193.6,-173.6 329.8,-173.6 329.8,-173.6 334.6,-173.6 339.4,-178.4 339.4,-183.2 339.4,-183.2 339.4,-192.8 339.4,-192.8 339.4,-197.6 334.6,-202.4 329.8,-202.4" data-name="attention"/>
<text text-anchor="middle" x="261.7" y="-184.3" font-family="Arial, Helvetica, sans-serif" font-size="11.00" data-name="attention">attention (MultiheadAttention)</text>
</a>
</g>
</g>
<!-- node_root_model&#45;&gt;node_attention -->
<g id="edge_node_root_model_node_attention" class="edge">
<title>node_root_model&#45;&gt;node_attention</title>
<path fill="none" stroke="#757575" d="M808.9,-275C654.92,-275 261.7,-275 261.7,-275 261.7,-275 261.7,-211.27 261.7,-211.27"/>
<polygon fill="#757575" stroke="#757575" points="264.15,-211.27 261.7,-204.27 259.25,-211.27 264.15,-211.27"/>
</g>
<!-- node_classifier -->
<g id="node_classifier" class="node" data-name="classifier">
<title>node_classifier</title>
<g id="a_node_classifier"><a xlink:title="Name: classifier&#10;Type: Sequential&#10;Parameters: 8,906&#10;Trainable: Yes">
<path fill="#e5f5fd" stroke="#4285f4" d="M667.68,-202.4C667.68,-202.4 569.73,-202.4 569.73,-202.4 564.92,-202.4 560.12,-197.6 560.12,-192.8 560.12,-192.8 560.12,-183.2 560.12,-183.2 560.12,-178.4 564.92,-173.6 569.73,-173.6 569.73,-173.6 667.68,-173.6 667.68,-173.6 672.48,-173.6 677.28,-178.4 677.28,-183.2 677.28,-183.2 677.28,-192.8 677.28,-192.8 677.28,-197.6 672.48,-202.4 667.68,-202.4" data-name="classifier"/>
<text text-anchor="middle" x="618.7" y="-184.3" font-family="Arial, Helvetica, sans-serif" font-size="11.00" data-name="classifier">classifier (Sequential)</text>
</a>
</g>
</g>
<!-- node_root_model&#45;&gt;node_classifier -->
<g id="edge_node_root_model_node_classifier" class="edge">
<title>node_root_model&#45;&gt;node_classifier</title>
<path fill="none" stroke="#757575" d="M827.88,-260.62C827.88,-236.46 827.88,-191 827.88,-191 827.88,-191 686.04,-191 686.04,-191"/>
<polygon fill="#757575" stroke="#757575" points="686.04,-188.55 679.04,-191 686.04,-193.45 686.04,-188.55"/>
</g>
<!-- node_decoder -->
<g id="node_decoder" class="node" data-name="decoder">
<title>node_decoder</title>
<g id="a_node_decoder"><a xlink:title="Name: decoder&#10;Type: Sequential&#10;Parameters: 139,683&#10;Trainable: Yes">
<path fill="#e5f5fd" stroke="#4285f4" d="M1216.55,-202.4C1216.55,-202.4 1120.85,-202.4 1120.85,-202.4 1116.05,-202.4 1111.25,-197.6 1111.25,-192.8 1111.25,-192.8 1111.25,-183.2 1111.25,-183.2 1111.25,-178.4 1116.05,-173.6 1120.85,-173.6 1120.85,-173.6 1216.55,-173.6 1216.55,-173.6 1221.35,-173.6 1226.15,-178.4 1226.15,-183.2 1226.15,-183.2 1226.15,-192.8 1226.15,-192.8 1226.15,-197.6 1221.35,-202.4 1216.55,-202.4" data-name="decoder"/>
<text text-anchor="middle" x="1168.7" y="-184.3" font-family="Arial, Helvetica, sans-serif" font-size="11.00" data-name="decoder">decoder (Sequential)</text>
</a>
</g>
</g>
<!-- node_root_model&#45;&gt;node_decoder -->
<g id="edge_node_root_model_node_decoder" class="edge">
<title>node_root_model&#45;&gt;node_decoder</title>
<path fill="none" stroke="#757575" d="M919.26,-260.57C919.26,-237.89 919.26,-197 919.26,-197 919.26,-197 1102.33,-197 1102.33,-197"/>
<polygon fill="#757575" stroke="#757575" points="1102.33,-199.45 1109.33,-197 1102.33,-194.55 1102.33,-199.45"/>
</g>
<!-- node_encoder -->
<g id="node_encoder" class="node" data-name="encoder">
<title>node_encoder</title>
<g id="a_node_encoder"><a xlink:title="Name: encoder&#10;Type: Sequential&#10;Parameters: 260,928&#10;Trainable: Yes">
<path fill="#e5f5fd" stroke="#4285f4" d="M2153.55,-202.4C2153.55,-202.4 2057.85,-202.4 2057.85,-202.4 2053.05,-202.4 2048.25,-197.6 2048.25,-192.8 2048.25,-192.8 2048.25,-183.2 2048.25,-183.2 2048.25,-178.4 2053.05,-173.6 2057.85,-173.6 2057.85,-173.6 2153.55,-173.6 2153.55,-173.6 2158.35,-173.6 2163.15,-178.4 2163.15,-183.2 2163.15,-183.2 2163.15,-192.8 2163.15,-192.8 2163.15,-197.6 2158.35,-202.4 2153.55,-202.4" data-name="encoder"/>
<text text-anchor="middle" x="2105.7" y="-184.3" font-family="Arial, Helvetica, sans-serif" font-size="11.00" data-name="encoder">encoder (Sequential)</text>
</a>
</g>
</g>
<!-- node_root_model&#45;&gt;node_encoder -->
<g id="edge_node_root_model_node_encoder" class="edge">
<title>node_root_model&#45;&gt;node_encoder</title>
<path fill="none" stroke="#757575" d="M930.57,-275C1179.35,-275 2105.7,-275 2105.7,-275 2105.7,-275 2105.7,-211.27 2105.7,-211.27"/>
<polygon fill="#757575" stroke="#757575" points="2108.15,-211.27 2105.7,-204.27 2103.25,-211.27 2108.15,-211.27"/>
</g>
<!-- node_attention_out_proj -->
<g id="node_attention_out_proj" class="node" data-name="attention.out_proj">
<title>node_attention_out_proj</title>
<g id="a_node_attention_out_proj"><a xlink:title="Name: attention.out_proj&#10;Type: NonDynamicallyQuantizableLinear&#10;Parameters: 16,512&#10;Trainable: Yes">
<path fill="#c2e0f4" stroke="#4285f4" d="M157.8,-115.6C157.8,-115.6 9.6,-115.6 9.6,-115.6 4.8,-115.6 0,-110.8 0,-106 0,-106 0,-96.4 0,-96.4 0,-91.6 4.8,-86.8 9.6,-86.8 9.6,-86.8 157.8,-86.8 157.8,-86.8 162.6,-86.8 167.4,-91.6 167.4,-96.4 167.4,-96.4 167.4,-106 167.4,-106 167.4,-110.8 162.6,-115.6 157.8,-115.6" data-name="attention.out_proj"/>
<text text-anchor="middle" x="83.7" y="-97.5" font-family="Arial, Helvetica, sans-serif" font-size="11.00" data-name="attention.out_proj">out_proj (NonDynamicallyQua...</text>
</a>
</g>
</g>
<!-- node_attention&#45;&gt;node_attention_out_proj -->
<g id="edge_node_attention_node_attention_out_proj" class="edge">
<title>node_attention&#45;&gt;node_attention_out_proj</title>
<path fill="none" stroke="#757575" d="M197,-173.24C197,-148.42 197,-101 197,-101 197,-101 176.34,-101 176.34,-101"/>
<polygon fill="#757575" stroke="#757575" points="176.34,-98.55 169.34,-101 176.34,-103.45 176.34,-98.55"/>
</g>
<!-- node_classifier_0 -->
<g id="node_classifier_0" class="node" data-name="classifier.0">
<title>node_classifier_0</title>
<g id="a_node_classifier_0"><a xlink:title="Name: classifier.0&#10;Type: AdaptiveAvgPool2d&#10;Parameters: 0&#10;Trainable: No">
<path fill="#c2e0f4" stroke="#4285f4" d="M325.8,-115.6C325.8,-115.6 219.6,-115.6 219.6,-115.6 214.8,-115.6 210,-110.8 210,-106 210,-106 210,-96.4 210,-96.4 210,-91.6 214.8,-86.8 219.6,-86.8 219.6,-86.8 325.8,-86.8 325.8,-86.8 330.6,-86.8 335.4,-91.6 335.4,-96.4 335.4,-96.4 335.4,-106 335.4,-106 335.4,-110.8 330.6,-115.6 325.8,-115.6" data-name="classifier.0"/>
<text text-anchor="middle" x="272.7" y="-97.5" font-family="Arial, Helvetica, sans-serif" font-size="11.00" data-name="classifier.0">0 (AdaptiveAvgPool2d)</text>
</a>
</g>
</g>
<!-- node_classifier&#45;&gt;node_classifier_0 -->
<g id="edge_node_classifier_node_classifier_0" class="edge">
<title>node_classifier&#45;&gt;node_classifier_0</title>
<path fill="none" stroke="#757575" d="M559.79,-193C483.19,-193 359.08,-193 359.08,-193 359.08,-193 359.08,-101 359.08,-101 359.08,-101 343.99,-101 343.99,-101"/>
<polygon fill="#757575" stroke="#757575" points="343.99,-98.55 336.99,-101 343.99,-103.45 343.99,-98.55"/>
</g>
<!-- node_classifier_1 -->
<g id="node_classifier_1" class="node" data-name="classifier.1">
<title>node_classifier_1</title>
<g id="a_node_classifier_1"><a xlink:title="Name: classifier.1&#10;Type: Flatten&#10;Parameters: 0&#10;Trainable: No">
<path fill="#c2e0f4" stroke="#4285f4" d="M433.05,-115.6C433.05,-115.6 388.35,-115.6 388.35,-115.6 383.55,-115.6 378.75,-110.8 378.75,-106 378.75,-106 378.75,-96.4 378.75,-96.4 378.75,-91.6 383.55,-86.8 388.35,-86.8 388.35,-86.8 433.05,-86.8 433.05,-86.8 437.85,-86.8 442.65,-91.6 442.65,-96.4 442.65,-96.4 442.65,-106 442.65,-106 442.65,-110.8 437.85,-115.6 433.05,-115.6" data-name="classifier.1"/>
<text text-anchor="middle" x="410.7" y="-97.5" font-family="Arial, Helvetica, sans-serif" font-size="11.00" data-name="classifier.1">1 (Flatten)</text>
</a>
</g>
</g>
<!-- node_classifier&#45;&gt;node_classifier_1 -->
<g id="edge_node_classifier_node_classifier_1" class="edge">
<title>node_classifier&#45;&gt;node_classifier_1</title>
<path fill="none" stroke="#757575" d="M559.65,-183C498.16,-183 410.7,-183 410.7,-183 410.7,-183 410.7,-124.34 410.7,-124.34"/>
<polygon fill="#757575" stroke="#757575" points="413.15,-124.34 410.7,-117.34 408.25,-124.34 413.15,-124.34"/>
</g>
<!-- node_classifier_2 -->
<g id="node_classifier_2" class="node" data-name="classifier.2">
<title>node_classifier_2</title>
<g id="a_node_classifier_2"><a xlink:title="Name: classifier.2&#10;Type: Linear&#10;Parameters: 8,256&#10;Trainable: Yes">
<path fill="#c2e0f4" stroke="#4285f4" d="M536.55,-115.6C536.55,-115.6 494.85,-115.6 494.85,-115.6 490.05,-115.6 485.25,-110.8 485.25,-106 485.25,-106 485.25,-96.4 485.25,-96.4 485.25,-91.6 490.05,-86.8 494.85,-86.8 494.85,-86.8 536.55,-86.8 536.55,-86.8 541.35,-86.8 546.15,-91.6 546.15,-96.4 546.15,-96.4 546.15,-106 546.15,-106 546.15,-110.8 541.35,-115.6 536.55,-115.6" data-name="classifier.2"/>
<text text-anchor="middle" x="515.7" y="-97.5" font-family="Arial, Helvetica, sans-serif" font-size="11.00" data-name="classifier.2">2 (Linear)</text>
</a>
</g>
</g>
<!-- node_classifier&#45;&gt;node_classifier_2 -->
<g id="edge_node_classifier_node_classifier_2" class="edge">
<title>node_classifier&#45;&gt;node_classifier_2</title>
<path fill="none" stroke="#757575" d="M573.73,-173.24C573.73,-148.42 573.73,-101 573.73,-101 573.73,-101 554.93,-101 554.93,-101"/>
<polygon fill="#757575" stroke="#757575" points="554.93,-98.55 547.93,-101 554.93,-103.45 554.93,-98.55"/>
</g>
<!-- node_classifier_3 -->
<g id="node_classifier_3" class="node" data-name="classifier.3">
<title>node_classifier_3</title>
<g id="a_node_classifier_3"><a xlink:title="Name: classifier.3&#10;Type: ReLU&#10;Parameters: 0&#10;Trainable: No">
<path fill="#c2e0f4" stroke="#4285f4" d="M638.8,-115.6C638.8,-115.6 598.6,-115.6 598.6,-115.6 593.8,-115.6 589,-110.8 589,-106 589,-106 589,-96.4 589,-96.4 589,-91.6 593.8,-86.8 598.6,-86.8 598.6,-86.8 638.8,-86.8 638.8,-86.8 643.6,-86.8 648.4,-91.6 648.4,-96.4 648.4,-96.4 648.4,-106 648.4,-106 648.4,-110.8 643.6,-115.6 638.8,-115.6" data-name="classifier.3"/>
<text text-anchor="middle" x="618.7" y="-97.5" font-family="Arial, Helvetica, sans-serif" font-size="11.00" data-name="classifier.3">3 (ReLU)</text>
</a>
</g>
</g>
<!-- node_classifier&#45;&gt;node_classifier_3 -->
<g id="edge_node_classifier_node_classifier_3" class="edge">
<title>node_classifier&#45;&gt;node_classifier_3</title>
<path fill="none" stroke="#757575" d="M618.7,-173.28C618.7,-173.28 618.7,-124.51 618.7,-124.51"/>
<polygon fill="#757575" stroke="#757575" points="621.15,-124.51 618.7,-117.51 616.25,-124.51 621.15,-124.51"/>
</g>
<!-- node_classifier_4 -->
<g id="node_classifier_4" class="node" data-name="classifier.4">
<title>node_classifier_4</title>
<g id="a_node_classifier_4"><a xlink:title="Name: classifier.4&#10;Type: Dropout&#10;Parameters: 0&#10;Trainable: No">
<path fill="#c2e0f4" stroke="#4285f4" d="M752.05,-115.6C752.05,-115.6 701.35,-115.6 701.35,-115.6 696.55,-115.6 691.75,-110.8 691.75,-106 691.75,-106 691.75,-96.4 691.75,-96.4 691.75,-91.6 696.55,-86.8 701.35,-86.8 701.35,-86.8 752.05,-86.8 752.05,-86.8 756.85,-86.8 761.65,-91.6 761.65,-96.4 761.65,-96.4 761.65,-106 761.65,-106 761.65,-110.8 756.85,-115.6 752.05,-115.6" data-name="classifier.4"/>
<text text-anchor="middle" x="726.7" y="-97.5" font-family="Arial, Helvetica, sans-serif" font-size="11.00" data-name="classifier.4">4 (Dropout)</text>
</a>
</g>
</g>
<!-- node_classifier&#45;&gt;node_classifier_4 -->
<g id="edge_node_classifier_node_classifier_4" class="edge">
<title>node_classifier&#45;&gt;node_classifier_4</title>
<path fill="none" stroke="#757575" d="M662.84,-173.24C662.84,-148.42 662.84,-101 662.84,-101 662.84,-101 682.89,-101 682.89,-101"/>
<polygon fill="#757575" stroke="#757575" points="682.89,-103.45 689.89,-101 682.89,-98.55 682.89,-103.45"/>
</g>
<!-- node_classifier_5 -->
<g id="node_classifier_5" class="node" data-name="classifier.5">
<title>node_classifier_5</title>
<g id="a_node_classifier_5"><a xlink:title="Name: classifier.5&#10;Type: Linear&#10;Parameters: 650&#10;Trainable: Yes">
<path fill="#c2e0f4" stroke="#4285f4" d="M855.55,-115.6C855.55,-115.6 813.85,-115.6 813.85,-115.6 809.05,-115.6 804.25,-110.8 804.25,-106 804.25,-106 804.25,-96.4 804.25,-96.4 804.25,-91.6 809.05,-86.8 813.85,-86.8 813.85,-86.8 855.55,-86.8 855.55,-86.8 860.35,-86.8 865.15,-91.6 865.15,-96.4 865.15,-96.4 865.15,-106 865.15,-106 865.15,-110.8 860.35,-115.6 855.55,-115.6" data-name="classifier.5"/>
<text text-anchor="middle" x="834.7" y="-97.5" font-family="Arial, Helvetica, sans-serif" font-size="11.00" data-name="classifier.5">5 (Linear)</text>
</a>
</g>
</g>
<!-- node_classifier&#45;&gt;node_classifier_5 -->
<g id="edge_node_classifier_node_classifier_5" class="edge">
<title>node_classifier&#45;&gt;node_classifier_5</title>
<path fill="none" stroke="#757575" d="M677.66,-185C745.17,-185 846.52,-185 846.52,-185 846.52,-185 846.52,-124.31 846.52,-124.31"/>
<polygon fill="#757575" stroke="#757575" points="848.97,-124.31 846.52,-117.31 844.07,-124.31 848.97,-124.31"/>
</g>
<!-- node_decoder_0 -->
<g id="node_decoder_0" class="node" data-name="decoder.0">
<title>node_decoder_0</title>
<g id="a_node_decoder_0"><a xlink:title="Name: decoder.0&#10;Type: CustomBlock&#10;Parameters: 110,976&#10;Trainable: Yes">
<path fill="#e5f5fd" stroke="#4285f4" d="M993.43,-115.6C993.43,-115.6 917.98,-115.6 917.98,-115.6 913.17,-115.6 908.38,-110.8 908.38,-106 908.38,-106 908.38,-96.4 908.38,-96.4 908.38,-91.6 913.17,-86.8 917.98,-86.8 917.98,-86.8 993.43,-86.8 993.43,-86.8 998.23,-86.8 1003.03,-91.6 1003.03,-96.4 1003.03,-96.4 1003.03,-106 1003.03,-106 1003.03,-110.8 998.23,-115.6 993.43,-115.6" data-name="decoder.0"/>
<text text-anchor="middle" x="955.7" y="-97.5" font-family="Arial, Helvetica, sans-serif" font-size="11.00" data-name="decoder.0">0 (CustomBlock)</text>
</a>
</g>
</g>
<!-- node_decoder&#45;&gt;node_decoder_0 -->
<g id="edge_node_decoder_node_decoder_0" class="edge">
<title>node_decoder&#45;&gt;node_decoder_0</title>
<path fill="none" stroke="#757575" d="M1110.78,-179C1051.06,-179 966.59,-179 966.59,-179 966.59,-179 966.59,-124.35 966.59,-124.35"/>
<polygon fill="#757575" stroke="#757575" points="969.04,-124.35 966.59,-117.35 964.14,-124.35 969.04,-124.35"/>
</g>
<!-- node_decoder_1 -->
<g id="node_decoder_1" class="node" data-name="decoder.1">
<title>node_decoder_1</title>
<g id="a_node_decoder_1"><a xlink:title="Name: decoder.1&#10;Type: Upsample&#10;Parameters: 0&#10;Trainable: No">
<path fill="#c2e0f4" stroke="#4285f4" d="M1133.93,-115.6C1133.93,-115.6 1073.47,-115.6 1073.47,-115.6 1068.67,-115.6 1063.88,-110.8 1063.88,-106 1063.88,-106 1063.88,-96.4 1063.88,-96.4 1063.88,-91.6 1068.67,-86.8 1073.47,-86.8 1073.47,-86.8 1133.93,-86.8 1133.93,-86.8 1138.73,-86.8 1143.53,-91.6 1143.53,-96.4 1143.53,-96.4 1143.53,-106 1143.53,-106 1143.53,-110.8 1138.73,-115.6 1133.93,-115.6" data-name="decoder.1"/>
<text text-anchor="middle" x="1103.7" y="-97.5" font-family="Arial, Helvetica, sans-serif" font-size="11.00" data-name="decoder.1">1 (Upsample)</text>
</a>
</g>
</g>
<!-- node_decoder&#45;&gt;node_decoder_1 -->
<g id="edge_node_decoder_node_decoder_1" class="edge">
<title>node_decoder&#45;&gt;node_decoder_1</title>
<path fill="none" stroke="#757575" d="M1127.39,-173.28C1127.39,-173.28 1127.39,-124.51 1127.39,-124.51"/>
<polygon fill="#757575" stroke="#757575" points="1129.84,-124.51 1127.39,-117.51 1124.94,-124.51 1129.84,-124.51"/>
</g>
<!-- node_decoder_2 -->
<g id="node_decoder_2" class="node" data-name="decoder.2">
<title>node_decoder_2</title>
<g id="a_node_decoder_2"><a xlink:title="Name: decoder.2&#10;Type: CustomBlock&#10;Parameters: 27,840&#10;Trainable: Yes">
<path fill="#e5f5fd" stroke="#4285f4" d="M1271.43,-115.6C1271.43,-115.6 1195.97,-115.6 1195.97,-115.6 1191.17,-115.6 1186.38,-110.8 1186.38,-106 1186.38,-106 1186.38,-96.4 1186.38,-96.4 1186.38,-91.6 1191.17,-86.8 1195.97,-86.8 1195.97,-86.8 1271.43,-86.8 1271.43,-86.8 1276.23,-86.8 1281.03,-91.6 1281.03,-96.4 1281.03,-96.4 1281.03,-106 1281.03,-106 1281.03,-110.8 1276.23,-115.6 1271.43,-115.6" data-name="decoder.2"/>
<text text-anchor="middle" x="1233.7" y="-97.5" font-family="Arial, Helvetica, sans-serif" font-size="11.00" data-name="decoder.2">2 (CustomBlock)</text>
</a>
</g>
</g>
<!-- node_decoder&#45;&gt;node_decoder_2 -->
<g id="edge_node_decoder_node_decoder_2" class="edge">
<title>node_decoder&#45;&gt;node_decoder_2</title>
<path fill="none" stroke="#757575" d="M1206.26,-173.28C1206.26,-173.28 1206.26,-124.51 1206.26,-124.51"/>
<polygon fill="#757575" stroke="#757575" points="1208.71,-124.51 1206.26,-117.51 1203.81,-124.51 1208.71,-124.51"/>
</g>
<!-- node_decoder_3 -->
<g id="node_decoder_3" class="node" data-name="decoder.3">
<title>node_decoder_3</title>
<g id="a_node_decoder_3"><a xlink:title="Name: decoder.3&#10;Type: Upsample&#10;Parameters: 0&#10;Trainable: No">
<path fill="#c2e0f4" stroke="#4285f4" d="M1393.93,-115.6C1393.93,-115.6 1333.47,-115.6 1333.47,-115.6 1328.67,-115.6 1323.88,-110.8 1323.88,-106 1323.88,-106 1323.88,-96.4 1323.88,-96.4 1323.88,-91.6 1328.67,-86.8 1333.47,-86.8 1333.47,-86.8 1393.93,-86.8 1393.93,-86.8 1398.73,-86.8 1403.53,-91.6 1403.53,-96.4 1403.53,-96.4 1403.53,-106 1403.53,-106 1403.53,-110.8 1398.73,-115.6 1393.93,-115.6" data-name="decoder.3"/>
<text text-anchor="middle" x="1363.7" y="-97.5" font-family="Arial, Helvetica, sans-serif" font-size="11.00" data-name="decoder.3">3 (Upsample)</text>
</a>
</g>
</g>
<!-- node_decoder&#45;&gt;node_decoder_3 -->
<g id="edge_node_decoder_node_decoder_3" class="edge">
<title>node_decoder&#45;&gt;node_decoder_3</title>
<path fill="none" stroke="#757575" d="M1226.41,-183C1283.92,-183 1363.7,-183 1363.7,-183 1363.7,-183 1363.7,-124.34 1363.7,-124.34"/>
<polygon fill="#757575" stroke="#757575" points="1366.15,-124.34 1363.7,-117.34 1361.25,-124.34 1366.15,-124.34"/>
</g>
<!-- node_decoder_4 -->
<g id="node_decoder_4" class="node" data-name="decoder.4">
<title>node_decoder_4</title>
<g id="a_node_decoder_4"><a xlink:title="Name: decoder.4&#10;Type: Conv2d&#10;Parameters: 867&#10;Trainable: Yes">
<path fill="#c2e0f4" stroke="#4285f4" d="M1505.3,-115.6C1505.3,-115.6 1456.1,-115.6 1456.1,-115.6 1451.3,-115.6 1446.5,-110.8 1446.5,-106 1446.5,-106 1446.5,-96.4 1446.5,-96.4 1446.5,-91.6 1451.3,-86.8 1456.1,-86.8 1456.1,-86.8 1505.3,-86.8 1505.3,-86.8 1510.1,-86.8 1514.9,-91.6 1514.9,-96.4 1514.9,-96.4 1514.9,-106 1514.9,-106 1514.9,-110.8 1510.1,-115.6 1505.3,-115.6" data-name="decoder.4"/>
<text text-anchor="middle" x="1480.7" y="-97.5" font-family="Arial, Helvetica, sans-serif" font-size="11.00" data-name="decoder.4">4 (Conv2d)</text>
</a>
</g>
</g>
<!-- node_decoder&#45;&gt;node_decoder_4 -->
<g id="edge_node_decoder_node_decoder_4" class="edge">
<title>node_decoder&#45;&gt;node_decoder_4</title>
<path fill="none" stroke="#757575" d="M1226.29,-193C1316.44,-193 1480.7,-193 1480.7,-193 1480.7,-193 1480.7,-124.46 1480.7,-124.46"/>
<polygon fill="#757575" stroke="#757575" points="1483.15,-124.46 1480.7,-117.46 1478.25,-124.46 1483.15,-124.46"/>
</g>
<!-- node_decoder_0_bn1 -->
<g id="node_decoder_0_bn1" class="node" data-name="decoder.0.bn1">
<title>node_decoder_0_bn1</title>
<g id="a_node_decoder_0_bn1"><a xlink:title="Name: decoder.0.bn1&#10;Type: BatchNorm2d&#10;Parameters: 128&#10;Trainable: Yes">
<path fill="#c2e0f4" stroke="#4285f4" d="M570.93,-28.8C570.93,-28.8 480.48,-28.8 480.48,-28.8 475.68,-28.8 470.88,-24 470.88,-19.2 470.88,-19.2 470.88,-9.6 470.88,-9.6 470.88,-4.8 475.68,0 480.48,0 480.48,0 570.93,0 570.93,0 575.73,0 580.53,-4.8 580.53,-9.6 580.53,-9.6 580.53,-19.2 580.53,-19.2 580.53,-24 575.73,-28.8 570.93,-28.8" data-name="decoder.0.bn1"/>
<text text-anchor="middle" x="525.7" y="-10.7" font-family="Arial, Helvetica, sans-serif" font-size="11.00" data-name="decoder.0.bn1">bn1 (BatchNorm2d)</text>
</a>
</g>
</g>
<!-- node_decoder_0&#45;&gt;node_decoder_0_bn1 -->
<g id="edge_node_decoder_0_node_decoder_0_bn1" class="edge">
<title>node_decoder_0&#45;&gt;node_decoder_0_bn1</title>
<path fill="none" stroke="#757575" d="M932.98,-86.56C932.98,-81.47 932.98,-77 932.98,-77 932.98,-77 566.93,-77 566.93,-77 566.93,-77 566.93,-37.75 566.93,-37.75"/>
<polygon fill="#757575" stroke="#757575" points="569.38,-37.75 566.93,-30.75 564.48,-37.75 569.38,-37.75"/>
</g>
<!-- node_decoder_0_bn2 -->
<g id="node_decoder_0_bn2" class="node" data-name="decoder.0.bn2">
<title>node_decoder_0_bn2</title>
<g id="a_node_decoder_0_bn2"><a xlink:title="Name: decoder.0.bn2&#10;Type: BatchNorm2d&#10;Parameters: 128&#10;Trainable: Yes">
<path fill="#c2e0f4" stroke="#4285f4" d="M723.93,-28.8C723.93,-28.8 633.48,-28.8 633.48,-28.8 628.67,-28.8 623.88,-24 623.88,-19.2 623.88,-19.2 623.88,-9.6 623.88,-9.6 623.88,-4.8 628.67,0 633.48,0 633.48,0 723.93,0 723.93,0 728.73,0 733.53,-4.8 733.53,-9.6 733.53,-9.6 733.53,-19.2 733.53,-19.2 733.53,-24 728.73,-28.8 723.93,-28.8" data-name="decoder.0.bn2"/>
<text text-anchor="middle" x="678.7" y="-10.7" font-family="Arial, Helvetica, sans-serif" font-size="11.00" data-name="decoder.0.bn2">bn2 (BatchNorm2d)</text>
</a>
</g>
</g>
<!-- node_decoder_0&#45;&gt;node_decoder_0_bn2 -->
<g id="edge_node_decoder_0_node_decoder_0_bn2" class="edge">
<title>node_decoder_0&#45;&gt;node_decoder_0_bn2</title>
<path fill="none" stroke="#757575" d="M955.7,-86.38C955.7,-70.64 955.7,-48 955.7,-48 955.7,-48 712.64,-48 712.64,-48 712.64,-48 712.64,-37.75 712.64,-37.75"/>
<polygon fill="#757575" stroke="#757575" points="715.09,-37.75 712.64,-30.75 710.19,-37.75 715.09,-37.75"/>
</g>
<!-- node_decoder_0_conv1 -->
<g id="node_decoder_0_conv1" class="node" data-name="decoder.0.conv1">
<title>node_decoder_0_conv1</title>
<g id="a_node_decoder_0_conv1"><a xlink:title="Name: decoder.0.conv1&#10;Type: Conv2d&#10;Parameters: 73,792&#10;Trainable: Yes">
<path fill="#c2e0f4" stroke="#4285f4" d="M857.55,-28.8C857.55,-28.8 785.85,-28.8 785.85,-28.8 781.05,-28.8 776.25,-24 776.25,-19.2 776.25,-19.2 776.25,-9.6 776.25,-9.6 776.25,-4.8 781.05,0 785.85,0 785.85,0 857.55,0 857.55,0 862.35,0 867.15,-4.8 867.15,-9.6 867.15,-9.6 867.15,-19.2 867.15,-19.2 867.15,-24 862.35,-28.8 857.55,-28.8" data-name="decoder.0.conv1"/>
<text text-anchor="middle" x="821.7" y="-10.7" font-family="Arial, Helvetica, sans-serif" font-size="11.00" data-name="decoder.0.conv1">conv1 (Conv2d)</text>
</a>
</g>
</g>
<!-- node_decoder_0&#45;&gt;node_decoder_0_conv1 -->
<g id="edge_node_decoder_0_node_decoder_0_conv1" class="edge">
<title>node_decoder_0&#45;&gt;node_decoder_0_conv1</title>
<path fill="none" stroke="#757575" d="M908.15,-101C896.73,-101 887.76,-101 887.76,-101 887.76,-101 887.76,-14 887.76,-14 887.76,-14 876.1,-14 876.1,-14"/>
<polygon fill="#757575" stroke="#757575" points="876.1,-11.55 869.1,-14 876.1,-16.45 876.1,-11.55"/>
</g>
<!-- node_decoder_0_conv2 -->
<g id="node_decoder_0_conv2" class="node" data-name="decoder.0.conv2">
<title>node_decoder_0_conv2</title>
<g id="a_node_decoder_0_conv2"><a xlink:title="Name: decoder.0.conv2&#10;Type: Conv2d&#10;Parameters: 36,928&#10;Trainable: Yes">
<path fill="#c2e0f4" stroke="#4285f4" d="M991.55,-28.8C991.55,-28.8 919.85,-28.8 919.85,-28.8 915.05,-28.8 910.25,-24 910.25,-19.2 910.25,-19.2 910.25,-9.6 910.25,-9.6 910.25,-4.8 915.05,0 919.85,0 919.85,0 991.55,0 991.55,0 996.35,0 1001.15,-4.8 1001.15,-9.6 1001.15,-9.6 1001.15,-19.2 1001.15,-19.2 1001.15,-24 996.35,-28.8 991.55,-28.8" data-name="decoder.0.conv2"/>
<text text-anchor="middle" x="955.7" y="-10.7" font-family="Arial, Helvetica, sans-serif" font-size="11.00" data-name="decoder.0.conv2">conv2 (Conv2d)</text>
</a>
</g>
</g>
<!-- node_decoder_0&#45;&gt;node_decoder_0_conv2 -->
<g id="edge_node_decoder_0_node_decoder_0_conv2" class="edge">
<title>node_decoder_0&#45;&gt;node_decoder_0_conv2</title>
<path fill="none" stroke="#757575" d="M978.43,-86.48C978.43,-86.48 978.43,-37.71 978.43,-37.71"/>
<polygon fill="#757575" stroke="#757575" points="980.88,-37.71 978.43,-30.71 975.98,-37.71 980.88,-37.71"/>
</g>
<!-- node_decoder_2_bn1 -->
<g id="node_decoder_2_bn1" class="node" data-name="decoder.2.bn1">
<title>node_decoder_2_bn1</title>
<g id="a_node_decoder_2_bn1"><a xlink:title="Name: decoder.2.bn1&#10;Type: BatchNorm2d&#10;Parameters: 64&#10;Trainable: Yes">
<path fill="#c2e0f4" stroke="#4285f4" d="M1143.93,-28.8C1143.93,-28.8 1053.47,-28.8 1053.47,-28.8 1048.67,-28.8 1043.88,-24 1043.88,-19.2 1043.88,-19.2 1043.88,-9.6 1043.88,-9.6 1043.88,-4.8 1048.67,0 1053.47,0 1053.47,0 1143.93,0 1143.93,0 1148.73,0 1153.53,-4.8 1153.53,-9.6 1153.53,-9.6 1153.53,-19.2 1153.53,-19.2 1153.53,-24 1148.73,-28.8 1143.93,-28.8" data-name="decoder.2.bn1"/>
<text text-anchor="middle" x="1098.7" y="-10.7" font-family="Arial, Helvetica, sans-serif" font-size="11.00" data-name="decoder.2.bn1">bn1 (BatchNorm2d)</text>
</a>
</g>
</g>
<!-- node_decoder_2&#45;&gt;node_decoder_2_bn1 -->
<g id="edge_node_decoder_2_node_decoder_2_bn1" class="edge">
<title>node_decoder_2&#45;&gt;node_decoder_2_bn1</title>
<path fill="none" stroke="#757575" d="M1186.13,-101C1166.62,-101 1148.53,-101 1148.53,-101 1148.53,-101 1148.53,-37.6 1148.53,-37.6"/>
<polygon fill="#757575" stroke="#757575" points="1150.98,-37.6 1148.53,-30.6 1146.08,-37.6 1150.98,-37.6"/>
</g>
<!-- node_decoder_2_bn2 -->
<g id="node_decoder_2_bn2" class="node" data-name="decoder.2.bn2">
<title>node_decoder_2_bn2</title>
<g id="a_node_decoder_2_bn2"><a xlink:title="Name: decoder.2.bn2&#10;Type: BatchNorm2d&#10;Parameters: 64&#10;Trainable: Yes">
<path fill="#c2e0f4" stroke="#4285f4" d="M1296.93,-28.8C1296.93,-28.8 1206.47,-28.8 1206.47,-28.8 1201.67,-28.8 1196.88,-24 1196.88,-19.2 1196.88,-19.2 1196.88,-9.6 1196.88,-9.6 1196.88,-4.8 1201.67,0 1206.47,0 1206.47,0 1296.93,0 1296.93,0 1301.73,0 1306.53,-4.8 1306.53,-9.6 1306.53,-9.6 1306.53,-19.2 1306.53,-19.2 1306.53,-24 1301.73,-28.8 1296.93,-28.8" data-name="decoder.2.bn2"/>
<text text-anchor="middle" x="1251.7" y="-10.7" font-family="Arial, Helvetica, sans-serif" font-size="11.00" data-name="decoder.2.bn2">bn2 (BatchNorm2d)</text>
</a>
</g>
</g>
<!-- node_decoder_2&#45;&gt;node_decoder_2_bn2 -->
<g id="edge_node_decoder_2_node_decoder_2_bn2" class="edge">
<title>node_decoder_2&#45;&gt;node_decoder_2_bn2</title>
<path fill="none" stroke="#757575" d="M1224.93,-86.48C1224.93,-86.48 1224.93,-37.71 1224.93,-37.71"/>
<polygon fill="#757575" stroke="#757575" points="1227.38,-37.71 1224.93,-30.71 1222.48,-37.71 1227.38,-37.71"/>
</g>
<!-- node_decoder_2_conv1 -->
<g id="node_decoder_2_conv1" class="node" data-name="decoder.2.conv1">
<title>node_decoder_2_conv1</title>
<g id="a_node_decoder_2_conv1"><a xlink:title="Name: decoder.2.conv1&#10;Type: Conv2d&#10;Parameters: 18,464&#10;Trainable: Yes">
<path fill="#c2e0f4" stroke="#4285f4" d="M1430.55,-28.8C1430.55,-28.8 1358.85,-28.8 1358.85,-28.8 1354.05,-28.8 1349.25,-24 1349.25,-19.2 1349.25,-19.2 1349.25,-9.6 1349.25,-9.6 1349.25,-4.8 1354.05,0 1358.85,0 1358.85,0 1430.55,0 1430.55,0 1435.35,0 1440.15,-4.8 1440.15,-9.6 1440.15,-9.6 1440.15,-19.2 1440.15,-19.2 1440.15,-24 1435.35,-28.8 1430.55,-28.8" data-name="decoder.2.conv1"/>
<text text-anchor="middle" x="1394.7" y="-10.7" font-family="Arial, Helvetica, sans-serif" font-size="11.00" data-name="decoder.2.conv1">conv1 (Conv2d)</text>
</a>
</g>
</g>
<!-- node_decoder_2&#45;&gt;node_decoder_2_conv1 -->
<g id="edge_node_decoder_2_node_decoder_2_conv1" class="edge">
<title>node_decoder_2&#45;&gt;node_decoder_2_conv1</title>
<path fill="none" stroke="#757575" d="M1281.11,-101C1299.04,-101 1315.2,-101 1315.2,-101 1315.2,-101 1315.2,-14 1315.2,-14 1315.2,-14 1340.4,-14 1340.4,-14"/>
<polygon fill="#757575" stroke="#757575" points="1340.4,-16.45 1347.4,-14 1340.4,-11.55 1340.4,-16.45"/>
</g>
<!-- node_decoder_2_conv2 -->
<g id="node_decoder_2_conv2" class="node" data-name="decoder.2.conv2">
<title>node_decoder_2_conv2</title>
<g id="a_node_decoder_2_conv2"><a xlink:title="Name: decoder.2.conv2&#10;Type: Conv2d&#10;Parameters: 9,248&#10;Trainable: Yes">
<path fill="#c2e0f4" stroke="#4285f4" d="M1564.55,-28.8C1564.55,-28.8 1492.85,-28.8 1492.85,-28.8 1488.05,-28.8 1483.25,-24 1483.25,-19.2 1483.25,-19.2 1483.25,-9.6 1483.25,-9.6 1483.25,-4.8 1488.05,0 1492.85,0 1492.85,0 1564.55,0 1564.55,0 1569.35,0 1574.15,-4.8 1574.15,-9.6 1574.15,-9.6 1574.15,-19.2 1574.15,-19.2 1574.15,-24 1569.35,-28.8 1564.55,-28.8" data-name="decoder.2.conv2"/>
<text text-anchor="middle" x="1528.7" y="-10.7" font-family="Arial, Helvetica, sans-serif" font-size="11.00" data-name="decoder.2.conv2">conv2 (Conv2d)</text>
</a>
</g>
</g>
<!-- node_decoder_2&#45;&gt;node_decoder_2_conv2 -->
<g id="edge_node_decoder_2_node_decoder_2_conv2" class="edge">
<title>node_decoder_2&#45;&gt;node_decoder_2_conv2</title>
<path fill="none" stroke="#757575" d="M1252.97,-86.57C1252.97,-74.04 1252.97,-58 1252.97,-58 1252.97,-58 1499.08,-58 1499.08,-58 1499.08,-58 1499.08,-37.67 1499.08,-37.67"/>
<polygon fill="#757575" stroke="#757575" points="1501.53,-37.67 1499.08,-30.67 1496.63,-37.67 1501.53,-37.67"/>
</g>
<!-- node_encoder_0 -->
<g id="node_encoder_0" class="node" data-name="encoder.0">
<title>node_encoder_0</title>
<g id="a_node_encoder_0"><a xlink:title="Name: encoder.0&#10;Type: CustomBlock&#10;Parameters: 38,976&#10;Trainable: Yes">
<path fill="#e5f5fd" stroke="#4285f4" d="M2005.43,-115.6C2005.43,-115.6 1929.97,-115.6 1929.97,-115.6 1925.17,-115.6 1920.38,-110.8 1920.38,-106 1920.38,-106 1920.38,-96.4 1920.38,-96.4 1920.38,-91.6 1925.17,-86.8 1929.97,-86.8 1929.97,-86.8 2005.43,-86.8 2005.43,-86.8 2010.23,-86.8 2015.03,-91.6 2015.03,-96.4 2015.03,-96.4 2015.03,-106 2015.03,-106 2015.03,-110.8 2010.23,-115.6 2005.43,-115.6" data-name="encoder.0"/>
<text text-anchor="middle" x="1967.7" y="-97.5" font-family="Arial, Helvetica, sans-serif" font-size="11.00" data-name="encoder.0">0 (CustomBlock)</text>
</a>
</g>
</g>
<!-- node_encoder&#45;&gt;node_encoder_0 -->
<g id="edge_node_encoder_node_encoder_0" class="edge">
<title>node_encoder&#45;&gt;node_encoder_0</title>
<path fill="none" stroke="#757575" d="M2052.25,-173.34C2052.25,-149.75 2052.25,-106 2052.25,-106 2052.25,-106 2023.92,-106 2023.92,-106"/>
<polygon fill="#757575" stroke="#757575" points="2023.92,-103.55 2016.92,-106 2023.92,-108.45 2023.92,-103.55"/>
</g>
<!-- node_encoder_1 -->
<g id="node_encoder_1" class="node" data-name="encoder.1">
<title>node_encoder_1</title>
<g id="a_node_encoder_1"><a xlink:title="Name: encoder.1&#10;Type: MaxPool2d&#10;Parameters: 0&#10;Trainable: No">
<path fill="#c2e0f4" stroke="#4285f4" d="M2138.55,-115.6C2138.55,-115.6 2072.85,-115.6 2072.85,-115.6 2068.05,-115.6 2063.25,-110.8 2063.25,-106 2063.25,-106 2063.25,-96.4 2063.25,-96.4 2063.25,-91.6 2068.05,-86.8 2072.85,-86.8 2072.85,-86.8 2138.55,-86.8 2138.55,-86.8 2143.35,-86.8 2148.15,-91.6 2148.15,-96.4 2148.15,-96.4 2148.15,-106 2148.15,-106 2148.15,-110.8 2143.35,-115.6 2138.55,-115.6" data-name="encoder.1"/>
<text text-anchor="middle" x="2105.7" y="-97.5" font-family="Arial, Helvetica, sans-serif" font-size="11.00" data-name="encoder.1">1 (MaxPool2d)</text>
</a>
</g>
</g>
<!-- node_encoder&#45;&gt;node_encoder_1 -->
<g id="edge_node_encoder_node_encoder_1" class="edge">
<title>node_encoder&#45;&gt;node_encoder_1</title>
<path fill="none" stroke="#757575" d="M2105.7,-173.28C2105.7,-173.28 2105.7,-124.51 2105.7,-124.51"/>
<polygon fill="#757575" stroke="#757575" points="2108.15,-124.51 2105.7,-117.51 2103.25,-124.51 2108.15,-124.51"/>
</g>
<!-- node_encoder_2 -->
<g id="node_encoder_2" class="node" data-name="encoder.2">
<title>node_encoder_2</title>
<g id="a_node_encoder_2"><a xlink:title="Name: encoder.2&#10;Type: CustomBlock&#10;Parameters: 221,952&#10;Trainable: Yes">
<path fill="#e5f5fd" stroke="#4285f4" d="M2358.42,-115.6C2358.42,-115.6 2282.97,-115.6 2282.97,-115.6 2278.18,-115.6 2273.38,-110.8 2273.38,-106 2273.38,-106 2273.38,-96.4 2273.38,-96.4 2273.38,-91.6 2278.18,-86.8 2282.97,-86.8 2282.97,-86.8 2358.42,-86.8 2358.42,-86.8 2363.22,-86.8 2368.02,-91.6 2368.02,-96.4 2368.02,-96.4 2368.02,-106 2368.02,-106 2368.02,-110.8 2363.22,-115.6 2358.42,-115.6" data-name="encoder.2"/>
<text text-anchor="middle" x="2320.7" y="-97.5" font-family="Arial, Helvetica, sans-serif" font-size="11.00" data-name="encoder.2">2 (CustomBlock)</text>
</a>
</g>
</g>
<!-- node_encoder&#45;&gt;node_encoder_2 -->
<g id="edge_node_encoder_node_encoder_2" class="edge">
<title>node_encoder&#45;&gt;node_encoder_2</title>
<path fill="none" stroke="#757575" d="M2155.65,-173.24C2155.65,-148.42 2155.65,-101 2155.65,-101 2155.65,-101 2264.45,-101 2264.45,-101"/>
<polygon fill="#757575" stroke="#757575" points="2264.45,-103.45 2271.45,-101 2264.45,-98.55 2264.45,-103.45"/>
</g>
<!-- node_encoder_3 -->
<g id="node_encoder_3" class="node" data-name="encoder.3">
<title>node_encoder_3</title>
<g id="a_node_encoder_3"><a xlink:title="Name: encoder.3&#10;Type: MaxPool2d&#10;Parameters: 0&#10;Trainable: No">
<path fill="#c2e0f4" stroke="#4285f4" d="M2486.55,-115.6C2486.55,-115.6 2420.85,-115.6 2420.85,-115.6 2416.05,-115.6 2411.25,-110.8 2411.25,-106 2411.25,-106 2411.25,-96.4 2411.25,-96.4 2411.25,-91.6 2416.05,-86.8 2420.85,-86.8 2420.85,-86.8 2486.55,-86.8 2486.55,-86.8 2491.35,-86.8 2496.15,-91.6 2496.15,-96.4 2496.15,-96.4 2496.15,-106 2496.15,-106 2496.15,-110.8 2491.35,-115.6 2486.55,-115.6" data-name="encoder.3"/>
<text text-anchor="middle" x="2453.7" y="-97.5" font-family="Arial, Helvetica, sans-serif" font-size="11.00" data-name="encoder.3">3 (MaxPool2d)</text>
</a>
</g>
</g>
<!-- node_encoder&#45;&gt;node_encoder_3 -->
<g id="edge_node_encoder_node_encoder_3" class="edge">
<title>node_encoder&#45;&gt;node_encoder_3</title>
<path fill="none" stroke="#757575" d="M2163.56,-188C2262.51,-188 2453.7,-188 2453.7,-188 2453.7,-188 2453.7,-124.44 2453.7,-124.44"/>
<polygon fill="#757575" stroke="#757575" points="2456.15,-124.44 2453.7,-117.44 2451.25,-124.44 2456.15,-124.44"/>
</g>
<!-- node_encoder_0_bn1 -->
<g id="node_encoder_0_bn1" class="node" data-name="encoder.0.bn1">
<title>node_encoder_0_bn1</title>
<g id="a_node_encoder_0_bn1"><a xlink:title="Name: encoder.0.bn1&#10;Type: BatchNorm2d&#10;Parameters: 128&#10;Trainable: Yes">
<path fill="#c2e0f4" stroke="#4285f4" d="M1716.93,-28.8C1716.93,-28.8 1626.47,-28.8 1626.47,-28.8 1621.67,-28.8 1616.88,-24 1616.88,-19.2 1616.88,-19.2 1616.88,-9.6 1616.88,-9.6 1616.88,-4.8 1621.67,0 1626.47,0 1626.47,0 1716.93,0 1716.93,0 1721.73,0 1726.53,-4.8 1726.53,-9.6 1726.53,-9.6 1726.53,-19.2 1726.53,-19.2 1726.53,-24 1721.73,-28.8 1716.93,-28.8" data-name="encoder.0.bn1"/>
<text text-anchor="middle" x="1671.7" y="-10.7" font-family="Arial, Helvetica, sans-serif" font-size="11.00" data-name="encoder.0.bn1">bn1 (BatchNorm2d)</text>
</a>
</g>
</g>
<!-- node_encoder_0&#45;&gt;node_encoder_0_bn1 -->
<g id="edge_node_encoder_0_node_encoder_0_bn1" class="edge">
<title>node_encoder_0&#45;&gt;node_encoder_0_bn1</title>
<path fill="none" stroke="#757575" d="M1920.14,-106C1836.47,-106 1671.7,-106 1671.7,-106 1671.7,-106 1671.7,-37.63 1671.7,-37.63"/>
<polygon fill="#757575" stroke="#757575" points="1674.15,-37.63 1671.7,-30.63 1669.25,-37.63 1674.15,-37.63"/>
</g>
<!-- node_encoder_0_bn2 -->
<g id="node_encoder_0_bn2" class="node" data-name="encoder.0.bn2">
<title>node_encoder_0_bn2</title>
<g id="a_node_encoder_0_bn2"><a xlink:title="Name: encoder.0.bn2&#10;Type: BatchNorm2d&#10;Parameters: 128&#10;Trainable: Yes">
<path fill="#c2e0f4" stroke="#4285f4" d="M1869.93,-28.8C1869.93,-28.8 1779.47,-28.8 1779.47,-28.8 1774.67,-28.8 1769.88,-24 1769.88,-19.2 1769.88,-19.2 1769.88,-9.6 1769.88,-9.6 1769.88,-4.8 1774.67,0 1779.47,0 1779.47,0 1869.93,0 1869.93,0 1874.73,0 1879.53,-4.8 1879.53,-9.6 1879.53,-9.6 1879.53,-19.2 1879.53,-19.2 1879.53,-24 1874.73,-28.8 1869.93,-28.8" data-name="encoder.0.bn2"/>
<text text-anchor="middle" x="1824.7" y="-10.7" font-family="Arial, Helvetica, sans-serif" font-size="11.00" data-name="encoder.0.bn2">bn2 (BatchNorm2d)</text>
</a>
</g>
</g>
<!-- node_encoder_0&#45;&gt;node_encoder_0_bn2 -->
<g id="edge_node_encoder_0_node_encoder_0_bn2" class="edge">
<title>node_encoder_0&#45;&gt;node_encoder_0_bn2</title>
<path fill="none" stroke="#757575" d="M1920.08,-96C1878.48,-96 1824.7,-96 1824.7,-96 1824.7,-96 1824.7,-37.5 1824.7,-37.5"/>
<polygon fill="#757575" stroke="#757575" points="1827.15,-37.5 1824.7,-30.5 1822.25,-37.5 1827.15,-37.5"/>
</g>
<!-- node_encoder_0_conv1 -->
<g id="node_encoder_0_conv1" class="node" data-name="encoder.0.conv1">
<title>node_encoder_0_conv1</title>
<g id="a_node_encoder_0_conv1"><a xlink:title="Name: encoder.0.conv1&#10;Type: Conv2d&#10;Parameters: 1,792&#10;Trainable: Yes">
<path fill="#c2e0f4" stroke="#4285f4" d="M2003.55,-28.8C2003.55,-28.8 1931.85,-28.8 1931.85,-28.8 1927.05,-28.8 1922.25,-24 1922.25,-19.2 1922.25,-19.2 1922.25,-9.6 1922.25,-9.6 1922.25,-4.8 1927.05,0 1931.85,0 1931.85,0 2003.55,0 2003.55,0 2008.35,0 2013.15,-4.8 2013.15,-9.6 2013.15,-9.6 2013.15,-19.2 2013.15,-19.2 2013.15,-24 2008.35,-28.8 2003.55,-28.8" data-name="encoder.0.conv1"/>
<text text-anchor="middle" x="1967.7" y="-10.7" font-family="Arial, Helvetica, sans-serif" font-size="11.00" data-name="encoder.0.conv1">conv1 (Conv2d)</text>
</a>
</g>
</g>
<!-- node_encoder_0&#45;&gt;node_encoder_0_conv1 -->
<g id="edge_node_encoder_0_node_encoder_0_conv1" class="edge">
<title>node_encoder_0&#45;&gt;node_encoder_0_conv1</title>
<path fill="none" stroke="#757575" d="M1967.7,-86.48C1967.7,-86.48 1967.7,-37.71 1967.7,-37.71"/>
<polygon fill="#757575" stroke="#757575" points="1970.15,-37.71 1967.7,-30.71 1965.25,-37.71 1970.15,-37.71"/>
</g>
<!-- node_encoder_0_conv2 -->
<g id="node_encoder_0_conv2" class="node" data-name="encoder.0.conv2">
<title>node_encoder_0_conv2</title>
<g id="a_node_encoder_0_conv2"><a xlink:title="Name: encoder.0.conv2&#10;Type: Conv2d&#10;Parameters: 36,928&#10;Trainable: Yes">
<path fill="#c2e0f4" stroke="#4285f4" d="M2137.55,-28.8C2137.55,-28.8 2065.85,-28.8 2065.85,-28.8 2061.05,-28.8 2056.25,-24 2056.25,-19.2 2056.25,-19.2 2056.25,-9.6 2056.25,-9.6 2056.25,-4.8 2061.05,0 2065.85,0 2065.85,0 2137.55,0 2137.55,0 2142.35,0 2147.15,-4.8 2147.15,-9.6 2147.15,-9.6 2147.15,-19.2 2147.15,-19.2 2147.15,-24 2142.35,-28.8 2137.55,-28.8" data-name="encoder.0.conv2"/>
<text text-anchor="middle" x="2101.7" y="-10.7" font-family="Arial, Helvetica, sans-serif" font-size="11.00" data-name="encoder.0.conv2">conv2 (Conv2d)</text>
</a>
</g>
</g>
<!-- node_encoder_0&#45;&gt;node_encoder_0_conv2 -->
<g id="edge_node_encoder_0_node_encoder_0_conv2" class="edge">
<title>node_encoder_0&#45;&gt;node_encoder_0_conv2</title>
<path fill="none" stroke="#757575" d="M2015.34,-96C2037.8,-96 2059.75,-96 2059.75,-96 2059.75,-96 2059.75,-37.5 2059.75,-37.5"/>
<polygon fill="#757575" stroke="#757575" points="2062.2,-37.5 2059.75,-30.5 2057.3,-37.5 2062.2,-37.5"/>
</g>
<!-- node_encoder_2_bn1 -->
<g id="node_encoder_2_bn1" class="node" data-name="encoder.2.bn1">
<title>node_encoder_2_bn1</title>
<g id="a_node_encoder_2_bn1"><a xlink:title="Name: encoder.2.bn1&#10;Type: BatchNorm2d&#10;Parameters: 256&#10;Trainable: Yes">
<path fill="#c2e0f4" stroke="#4285f4" d="M2289.92,-28.8C2289.92,-28.8 2199.47,-28.8 2199.47,-28.8 2194.68,-28.8 2189.88,-24 2189.88,-19.2 2189.88,-19.2 2189.88,-9.6 2189.88,-9.6 2189.88,-4.8 2194.68,0 2199.47,0 2199.47,0 2289.92,0 2289.92,0 2294.72,0 2299.52,-4.8 2299.52,-9.6 2299.52,-9.6 2299.52,-19.2 2299.52,-19.2 2299.52,-24 2294.72,-28.8 2289.92,-28.8" data-name="encoder.2.bn1"/>
<text text-anchor="middle" x="2244.7" y="-10.7" font-family="Arial, Helvetica, sans-serif" font-size="11.00" data-name="encoder.2.bn1">bn1 (BatchNorm2d)</text>
</a>
</g>
</g>
<!-- node_encoder_2&#45;&gt;node_encoder_2_bn1 -->
<g id="edge_node_encoder_2_node_encoder_2_bn1" class="edge">
<title>node_encoder_2&#45;&gt;node_encoder_2_bn1</title>
<path fill="none" stroke="#757575" d="M2286.45,-86.48C2286.45,-86.48 2286.45,-37.71 2286.45,-37.71"/>
<polygon fill="#757575" stroke="#757575" points="2288.9,-37.71 2286.45,-30.71 2284,-37.71 2288.9,-37.71"/>
</g>
<!-- node_encoder_2_bn2 -->
<g id="node_encoder_2_bn2" class="node" data-name="encoder.2.bn2">
<title>node_encoder_2_bn2</title>
<g id="a_node_encoder_2_bn2"><a xlink:title="Name: encoder.2.bn2&#10;Type: BatchNorm2d&#10;Parameters: 256&#10;Trainable: Yes">
<path fill="#c2e0f4" stroke="#4285f4" d="M2442.92,-28.8C2442.92,-28.8 2352.47,-28.8 2352.47,-28.8 2347.68,-28.8 2342.88,-24 2342.88,-19.2 2342.88,-19.2 2342.88,-9.6 2342.88,-9.6 2342.88,-4.8 2347.68,0 2352.47,0 2352.47,0 2442.92,0 2442.92,0 2447.72,0 2452.52,-4.8 2452.52,-9.6 2452.52,-9.6 2452.52,-19.2 2452.52,-19.2 2452.52,-24 2447.72,-28.8 2442.92,-28.8" data-name="encoder.2.bn2"/>
<text text-anchor="middle" x="2397.7" y="-10.7" font-family="Arial, Helvetica, sans-serif" font-size="11.00" data-name="encoder.2.bn2">bn2 (BatchNorm2d)</text>
</a>
</g>
</g>
<!-- node_encoder_2&#45;&gt;node_encoder_2_bn2 -->
<g id="edge_node_encoder_2_node_encoder_2_bn2" class="edge">
<title>node_encoder_2&#45;&gt;node_encoder_2_bn2</title>
<path fill="none" stroke="#757575" d="M2349.16,-86.48C2349.16,-86.48 2349.16,-37.71 2349.16,-37.71"/>
<polygon fill="#757575" stroke="#757575" points="2351.61,-37.71 2349.16,-30.71 2346.71,-37.71 2351.61,-37.71"/>
</g>
<!-- node_encoder_2_conv1 -->
<g id="node_encoder_2_conv1" class="node" data-name="encoder.2.conv1">
<title>node_encoder_2_conv1</title>
<g id="a_node_encoder_2_conv1"><a xlink:title="Name: encoder.2.conv1&#10;Type: Conv2d&#10;Parameters: 73,856&#10;Trainable: Yes">
<path fill="#c2e0f4" stroke="#4285f4" d="M2576.55,-28.8C2576.55,-28.8 2504.85,-28.8 2504.85,-28.8 2500.05,-28.8 2495.25,-24 2495.25,-19.2 2495.25,-19.2 2495.25,-9.6 2495.25,-9.6 2495.25,-4.8 2500.05,0 2504.85,0 2504.85,0 2576.55,0 2576.55,0 2581.35,0 2586.15,-4.8 2586.15,-9.6 2586.15,-9.6 2586.15,-19.2 2586.15,-19.2 2586.15,-24 2581.35,-28.8 2576.55,-28.8" data-name="encoder.2.conv1"/>
<text text-anchor="middle" x="2540.7" y="-10.7" font-family="Arial, Helvetica, sans-serif" font-size="11.00" data-name="encoder.2.conv1">conv1 (Conv2d)</text>
</a>
</g>
</g>
<!-- node_encoder_2&#45;&gt;node_encoder_2_conv1 -->
<g id="edge_node_encoder_2_node_encoder_2_conv1" class="edge">
<title>node_encoder_2&#45;&gt;node_encoder_2_conv1</title>
<path fill="none" stroke="#757575" d="M2355.45,-86.54C2355.45,-67.87 2355.45,-38 2355.45,-38 2355.45,-38 2541.15,-38 2541.15,-38 2541.15,-38 2541.15,-37.12 2541.15,-37.12"/>
<polygon fill="#757575" stroke="#757575" points="2543.6,-37.73 2541.15,-30.73 2538.7,-37.73 2543.6,-37.73"/>
</g>
<!-- node_encoder_2_conv2 -->
<g id="node_encoder_2_conv2" class="node" data-name="encoder.2.conv2">
<title>node_encoder_2_conv2</title>
<g id="a_node_encoder_2_conv2"><a xlink:title="Name: encoder.2.conv2&#10;Type: Conv2d&#10;Parameters: 147,584&#10;Trainable: Yes">
<path fill="#c2e0f4" stroke="#4285f4" d="M2710.55,-28.8C2710.55,-28.8 2638.85,-28.8 2638.85,-28.8 2634.05,-28.8 2629.25,-24 2629.25,-19.2 2629.25,-19.2 2629.25,-9.6 2629.25,-9.6 2629.25,-4.8 2634.05,0 2638.85,0 2638.85,0 2710.55,0 2710.55,0 2715.35,0 2720.15,-4.8 2720.15,-9.6 2720.15,-9.6 2720.15,-19.2 2720.15,-19.2 2720.15,-24 2715.35,-28.8 2710.55,-28.8" data-name="encoder.2.conv2"/>
<text text-anchor="middle" x="2674.7" y="-10.7" font-family="Arial, Helvetica, sans-serif" font-size="11.00" data-name="encoder.2.conv2">conv2 (Conv2d)</text>
</a>
</g>
</g>
<!-- node_encoder_2&#45;&gt;node_encoder_2_conv2 -->
<g id="edge_node_encoder_2_node_encoder_2_conv2" class="edge">
<title>node_encoder_2&#45;&gt;node_encoder_2_conv2</title>
<path fill="none" stroke="#757575" d="M2361.74,-86.5C2361.74,-77.23 2361.74,-67 2361.74,-67 2361.74,-67 2674.7,-67 2674.7,-67 2674.7,-67 2674.7,-37.57 2674.7,-37.57"/>
<polygon fill="#757575" stroke="#757575" points="2677.15,-37.57 2674.7,-30.57 2672.25,-37.57 2677.15,-37.57"/>
</g>
</g>
</svg>

        </div>
        <div class="zoom-controls" role="group" aria-label="Zoom Controls">
            <button class="zoom-button" id="zoomIn" title="Zoom In (+)">+</button>
            <button class="zoom-button" id="zoomOut" title="Zoom Out (-)">-</button>
            <button class="zoom-button" id="resetZoom" title="Reset Zoom (100%)">Reset</button>
        </div>
    </div>
    <div class="resize-handle" id="resizeHandle" title="Resize visualization area" aria-label="Resize Handle"></div>

    <div class="info-panel" id="infoPanel" role="region" aria-live="polite" aria-labelledby="infoPanelHeader">
        <h3 id="infoPanelHeader">Module Information</h3>
        <p>Click on a module in the visualization to view its details.</p>
    </div>

    <div class="copy-notification" id="copyNotification" role="alert" aria-live="assertive">Module name copied to clipboard!</div>

    <div class="node-menu" id="nodeMenu" role="menu" aria-hidden="true">
        <div class="menu-item" id="copyName" role="menuitem">Copy Module Name</div>
        <div class="menu-item" id="showDetails" role="menuitem">Show Details</div>
        <div class="menu-item" id="highlightPath" role="menuitem">Highlight Path</div>
        <div class="menu-item" id="toggleCollapse" role="menuitem">Toggle Collapse</div>
    </div>

    <div class="help-tooltip" id="helpTooltip" role="dialog" aria-labelledby="helpTooltipHeader" aria-hidden="true">
      <h3 id="helpTooltipHeader">Keyboard Shortcuts & Tips</h3>
      <button id="closeHelpTooltip" aria-label="Close help" style="float: right; font-size: 1.2em; line-height: 1; padding: 0.2em 0.4em;">&times;</button>
      <ul>
        <li><b>Double-click node</b>: Collapse/expand node</li>
        <li><b>Right-click node</b>: Show context menu</li>
        <li><b>Alt + Drag / Middle-click Drag</b>: Move individual node</li>
        <li><b>Ctrl + Scroll / Pinch</b>: Zoom SVG</li>
        <li><b>Shift + Drag SVG</b>: Pan SVG</li>
        <li><b>Ctrl+F</b>: Focus search bar</li>
        <li><b>Esc</b>: Clear search / Close help</li>
        <li><b>? or Ctrl+H</b>: Show/hide this help</li>
      </ul>
      <p>Search examples: <code>MyLayer</code>, <code>type:Linear</code>, <code>trainable:yes</code>, <code>params:>1000</code></p>
    </div>

    <script>
        // Module information from Python
        const moduleInfo = {"root": {"type": "CustomModel", "parameters": 475565, "trainable": true, "class": "<class '__main__.CustomModel'>", "docstring": "A custom model architecture that combines different types of layers"}, "encoder": {"type": "Sequential", "parameters": 260928, "trainable": true, "class": "<class 'torch.nn.modules.container.Sequential'>", "docstring": "A sequential container."}, "encoder.0": {"type": "CustomBlock", "parameters": 38976, "trainable": true, "class": "<class '__main__.CustomBlock'>", "docstring": "A custom block with multiple layers"}, "encoder.0.conv1": {"type": "Conv2d", "parameters": 1792, "trainable": true, "class": "<class 'torch.nn.modules.conv.Conv2d'>", "docstring": "Applies a 2D convolution over an input signal composed of several input", "in_channels": 3, "out_channels": 64, "kernel_size": [3, 3], "stride": [1, 1], "padding": [1, 1], "groups": 1, "dilation": [1, 1]}, "encoder.0.bn1": {"type": "BatchNorm2d", "parameters": 128, "trainable": true, "class": "<class 'torch.nn.modules.batchnorm.BatchNorm2d'>", "docstring": "Applies Batch Normalization over a 4D input.", "num_features": 64, "eps": 1e-05, "momentum": 0.1, "affine": true}, "encoder.0.conv2": {"type": "Conv2d", "parameters": 36928, "trainable": true, "class": "<class 'torch.nn.modules.conv.Conv2d'>", "docstring": "Applies a 2D convolution over an input signal composed of several input", "in_channels": 64, "out_channels": 64, "kernel_size": [3, 3], "stride": [1, 1], "padding": [1, 1], "groups": 1, "dilation": [1, 1]}, "encoder.0.bn2": {"type": "BatchNorm2d", "parameters": 128, "trainable": true, "class": "<class 'torch.nn.modules.batchnorm.BatchNorm2d'>", "docstring": "Applies Batch Normalization over a 4D input.", "num_features": 64, "eps": 1e-05, "momentum": 0.1, "affine": true}, "encoder.1": {"type": "MaxPool2d", "parameters": 0, "trainable": false, "class": "<class 'torch.nn.modules.pooling.MaxPool2d'>", "docstring": "Applies a 2D max pooling over an input signal composed of several input planes.", "kernel_size": 2, "stride": 2, "padding": 0}, "encoder.2": {"type": "CustomBlock", "parameters": 221952, "trainable": true, "class": "<class '__main__.CustomBlock'>", "docstring": "A custom block with multiple layers"}, "encoder.2.conv1": {"type": "Conv2d", "parameters": 73856, "trainable": true, "class": "<class 'torch.nn.modules.conv.Conv2d'>", "docstring": "Applies a 2D convolution over an input signal composed of several input", "in_channels": 64, "out_channels": 128, "kernel_size": [3, 3], "stride": [1, 1], "padding": [1, 1], "groups": 1, "dilation": [1, 1]}, "encoder.2.bn1": {"type": "BatchNorm2d", "parameters": 256, "trainable": true, "class": "<class 'torch.nn.modules.batchnorm.BatchNorm2d'>", "docstring": "Applies Batch Normalization over a 4D input.", "num_features": 128, "eps": 1e-05, "momentum": 0.1, "affine": true}, "encoder.2.conv2": {"type": "Conv2d", "parameters": 147584, "trainable": true, "class": "<class 'torch.nn.modules.conv.Conv2d'>", "docstring": "Applies a 2D convolution over an input signal composed of several input", "in_channels": 128, "out_channels": 128, "kernel_size": [3, 3], "stride": [1, 1], "padding": [1, 1], "groups": 1, "dilation": [1, 1]}, "encoder.2.bn2": {"type": "BatchNorm2d", "parameters": 256, "trainable": true, "class": "<class 'torch.nn.modules.batchnorm.BatchNorm2d'>", "docstring": "Applies Batch Normalization over a 4D input.", "num_features": 128, "eps": 1e-05, "momentum": 0.1, "affine": true}, "encoder.3": {"type": "MaxPool2d", "parameters": 0, "trainable": false, "class": "<class 'torch.nn.modules.pooling.MaxPool2d'>", "docstring": "Applies a 2D max pooling over an input signal composed of several input planes.", "kernel_size": 2, "stride": 2, "padding": 0}, "decoder": {"type": "Sequential", "parameters": 139683, "trainable": true, "class": "<class 'torch.nn.modules.container.Sequential'>", "docstring": "A sequential container."}, "decoder.0": {"type": "CustomBlock", "parameters": 110976, "trainable": true, "class": "<class '__main__.CustomBlock'>", "docstring": "A custom block with multiple layers"}, "decoder.0.conv1": {"type": "Conv2d", "parameters": 73792, "trainable": true, "class": "<class 'torch.nn.modules.conv.Conv2d'>", "docstring": "Applies a 2D convolution over an input signal composed of several input", "in_channels": 128, "out_channels": 64, "kernel_size": [3, 3], "stride": [1, 1], "padding": [1, 1], "groups": 1, "dilation": [1, 1]}, "decoder.0.bn1": {"type": "BatchNorm2d", "parameters": 128, "trainable": true, "class": "<class 'torch.nn.modules.batchnorm.BatchNorm2d'>", "docstring": "Applies Batch Normalization over a 4D input.", "num_features": 64, "eps": 1e-05, "momentum": 0.1, "affine": true}, "decoder.0.conv2": {"type": "Conv2d", "parameters": 36928, "trainable": true, "class": "<class 'torch.nn.modules.conv.Conv2d'>", "docstring": "Applies a 2D convolution over an input signal composed of several input", "in_channels": 64, "out_channels": 64, "kernel_size": [3, 3], "stride": [1, 1], "padding": [1, 1], "groups": 1, "dilation": [1, 1]}, "decoder.0.bn2": {"type": "BatchNorm2d", "parameters": 128, "trainable": true, "class": "<class 'torch.nn.modules.batchnorm.BatchNorm2d'>", "docstring": "Applies Batch Normalization over a 4D input.", "num_features": 64, "eps": 1e-05, "momentum": 0.1, "affine": true}, "decoder.1": {"type": "Upsample", "parameters": 0, "trainable": false, "class": "<class 'torch.nn.modules.upsampling.Upsample'>", "docstring": "Upsamples a given multi-channel 1D (temporal), 2D (spatial) or 3D (volumetric) data."}, "decoder.2": {"type": "CustomBlock", "parameters": 27840, "trainable": true, "class": "<class '__main__.CustomBlock'>", "docstring": "A custom block with multiple layers"}, "decoder.2.conv1": {"type": "Conv2d", "parameters": 18464, "trainable": true, "class": "<class 'torch.nn.modules.conv.Conv2d'>", "docstring": "Applies a 2D convolution over an input signal composed of several input", "in_channels": 64, "out_channels": 32, "kernel_size": [3, 3], "stride": [1, 1], "padding": [1, 1], "groups": 1, "dilation": [1, 1]}, "decoder.2.bn1": {"type": "BatchNorm2d", "parameters": 64, "trainable": true, "class": "<class 'torch.nn.modules.batchnorm.BatchNorm2d'>", "docstring": "Applies Batch Normalization over a 4D input.", "num_features": 32, "eps": 1e-05, "momentum": 0.1, "affine": true}, "decoder.2.conv2": {"type": "Conv2d", "parameters": 9248, "trainable": true, "class": "<class 'torch.nn.modules.conv.Conv2d'>", "docstring": "Applies a 2D convolution over an input signal composed of several input", "in_channels": 32, "out_channels": 32, "kernel_size": [3, 3], "stride": [1, 1], "padding": [1, 1], "groups": 1, "dilation": [1, 1]}, "decoder.2.bn2": {"type": "BatchNorm2d", "parameters": 64, "trainable": true, "class": "<class 'torch.nn.modules.batchnorm.BatchNorm2d'>", "docstring": "Applies Batch Normalization over a 4D input.", "num_features": 32, "eps": 1e-05, "momentum": 0.1, "affine": true}, "decoder.3": {"type": "Upsample", "parameters": 0, "trainable": false, "class": "<class 'torch.nn.modules.upsampling.Upsample'>", "docstring": "Upsamples a given multi-channel 1D (temporal), 2D (spatial) or 3D (volumetric) data."}, "decoder.4": {"type": "Conv2d", "parameters": 867, "trainable": true, "class": "<class 'torch.nn.modules.conv.Conv2d'>", "docstring": "Applies a 2D convolution over an input signal composed of several input", "in_channels": 32, "out_channels": 3, "kernel_size": [3, 3], "stride": [1, 1], "padding": [1, 1], "groups": 1, "dilation": [1, 1]}, "attention": {"type": "MultiheadAttention", "parameters": 66048, "trainable": true, "class": "<class 'torch.nn.modules.activation.MultiheadAttention'>", "docstring": "Allows the model to jointly attend to information from different representation subspaces.", "embed_dim": 128, "num_heads": 4, "dropout": 0.0, "bias": false, "add_bias_kv": false, "add_zero_attn": false, "kdim": 128, "vdim": 128}, "attention.out_proj": {"type": "NonDynamicallyQuantizableLinear", "parameters": 16512, "trainable": true, "class": "<class 'torch.nn.modules.linear.NonDynamicallyQuantizableLinear'>", "docstring": "N/A", "in_features": 128, "out_features": 128, "bias": true}, "classifier": {"type": "Sequential", "parameters": 8906, "trainable": true, "class": "<class 'torch.nn.modules.container.Sequential'>", "docstring": "A sequential container."}, "classifier.0": {"type": "AdaptiveAvgPool2d", "parameters": 0, "trainable": false, "class": "<class 'torch.nn.modules.pooling.AdaptiveAvgPool2d'>", "docstring": "Applies a 2D adaptive average pooling over an input signal composed of several input planes.", "kernel_size": "N/A", "stride": "N/A", "padding": "N/A", "output_size": 1}, "classifier.1": {"type": "Flatten", "parameters": 0, "trainable": false, "class": "<class 'torch.nn.modules.flatten.Flatten'>", "docstring": "Flattens a contiguous range of dims into a tensor."}, "classifier.2": {"type": "Linear", "parameters": 8256, "trainable": true, "class": "<class 'torch.nn.modules.linear.Linear'>", "docstring": "Applies an affine linear transformation to the incoming data: :math:`y = xA^T + b`.", "in_features": 128, "out_features": 64, "bias": true}, "classifier.3": {"type": "ReLU", "parameters": 0, "trainable": false, "class": "<class 'torch.nn.modules.activation.ReLU'>", "docstring": "Applies the rectified linear unit function element-wise."}, "classifier.4": {"type": "Dropout", "parameters": 0, "trainable": false, "class": "<class 'torch.nn.modules.dropout.Dropout'>", "docstring": "During training, randomly zeroes some of the elements of the input tensor with probability :attr:`p`.", "p": 0.5, "inplace": false}, "classifier.5": {"type": "Linear", "parameters": 650, "trainable": true, "class": "<class 'torch.nn.modules.linear.Linear'>", "docstring": "Applies an affine linear transformation to the incoming data: :math:`y = xA^T + b`.", "in_features": 64, "out_features": 10, "bias": true}};
        
        // Setup interactive behavior
document.addEventListener('DOMContentLoaded', function() {
  const svgElement = document.querySelector('#svgPanZoomContainer svg'); // Target the SVG within the container
  const infoPanel = document.getElementById('infoPanel');
  const copyNotification = document.getElementById('copyNotification');
  const searchInput = document.getElementById('searchInput');
  const clearSearch = document.getElementById('clearSearch');
  const nodeMenu = document.getElementById('nodeMenu');
  const exportJSONBtn = document.getElementById('exportJSON');
  const expandAllBtn = document.getElementById('expandAll');
  const collapseAllBtn = document.getElementById('collapseAll');
  const themeToggleBtn = document.getElementById('themeToggle');
  const helpButton = document.getElementById('helpButton');
  const helpTooltip = document.getElementById('helpTooltip');
  const closeHelpTooltip = document.getElementById('closeHelpTooltip');
  const loadingIndicator = document.getElementById('loadingIndicator');
  const visualizationContainer = document.getElementById('visualizationContainer');
  const resizeHandle = document.getElementById('resizeHandle');

  // Track collapsed state of nodes by their data-name attribute
  const collapsedNodes = new Set();
  let svgPanZoomInstance; // To store the svg-pan-zoom instance

  // Function to show notification messages
  function showNotification(message, type = 'info') {
    if (!copyNotification) return;
    
    // Clear any existing timeout
    if (window.notificationTimeout) {
      clearTimeout(window.notificationTimeout);
    }
    
    // Set message and show
    copyNotification.textContent = message;
    copyNotification.className = 'copy-notification'; // Reset classes
    copyNotification.classList.add(type); // Add type class (success, error, info)
    copyNotification.style.opacity = '1';
    
    // Hide after delay
    window.notificationTimeout = setTimeout(() => {
      copyNotification.style.opacity = '0';
    }, 2000);
  }

  // Show loading indicator
  function showLoading(show = true) {
    if (loadingIndicator) {
      loadingIndicator.style.display = show ? 'block' : 'none';
    }
  }

  // Initialize SVG Pan Zoom (if the library is available)
  function initSvgPanZoom() {
    if (window.svgPanZoom && svgElement) {
      svgPanZoomInstance = svgPanZoom(svgElement, {
        zoomEnabled: true,
        controlIconsEnabled: false, // We use custom controls
        panEnabled: true,
        minZoom: 0.1,
        maxZoom: 10,
        zoomScaleSensitivity: 0.2,
        fit: true,
        center: true,
        onZoom: function() {
            // Future use: if needed to update something on zoom
        },
        onPan: function() {
            // Future use: if needed to update something on pan
        }
      });
      // Custom zoom buttons
      document.getElementById('zoomIn').addEventListener('click', () => svgPanZoomInstance.zoomIn());
      document.getElementById('zoomOut').addEventListener('click', () => svgPanZoomInstance.zoomOut());
      document.getElementById('resetZoom').addEventListener('click', () => svgPanZoomInstance.resetZoom());
    } else {
      console.warn('svg-pan-zoom library not found or SVG element missing. Pan and zoom will be basic.');
      // Fallback basic zoom (if svg-pan-zoom is not used)
      let zoomLevel = 1;
      const zoomInBasic = document.getElementById('zoomIn');
      const zoomOutBasic = document.getElementById('zoomOut');
      const resetZoomBasic = document.getElementById('resetZoom');

      function updateBasicZoom() {
          if (svgElement) {
            svgElement.style.transform = `scale(${zoomLevel})`;
            svgElement.style.transformOrigin = 'center center'; // Or 'top left'
          }
      }
      if (zoomInBasic) zoomInBasic.addEventListener('click', () => { zoomLevel = Math.min(10, zoomLevel + 0.1); updateBasicZoom(); });
      if (zoomOutBasic) zoomOutBasic.addEventListener('click', () => { zoomLevel = Math.max(0.1, zoomLevel - 0.1); updateBasicZoom(); });
      if (resetZoomBasic) resetZoomBasic.addEventListener('click', () => { zoomLevel = 1; updateBasicZoom(); });
    }
  }
  
  // Call init after SVG content is loaded (or if it's inline, DOMContentLoaded is enough)
  // If SVG is loaded dynamically, this might need to be called after SVG is injected.
  if (svgElement) {
    initSvgPanZoom();
  } else {
    console.error("SVG element for pan/zoom not found.");
  }


  // Theme Toggling
  function applyTheme(theme) {
    document.body.classList.toggle('dark-theme', theme === 'dark');
    localStorage.setItem('visualizationTheme', theme);
  }

  themeToggleBtn.addEventListener('click', () => {
    const currentTheme = document.body.classList.contains('dark-theme') ? 'dark' : 'light';
    applyTheme(currentTheme === 'dark' ? 'light' : 'dark');
  });

  // Load saved theme
  const savedTheme = localStorage.getItem('visualizationTheme');
  if (savedTheme) {
    applyTheme(savedTheme);
  } else {
    // Default to light or respect OS preference if desired
    applyTheme('light'); 
  }

  // Help Tooltip
  function toggleHelp(show) {
    if (helpTooltip) {
        helpTooltip.style.display = show ? 'block' : 'none';
        helpTooltip.setAttribute('aria-hidden', !show);
        if (show) helpTooltip.focus(); // For accessibility
    }
  }
  if (helpButton) helpButton.addEventListener('click', (e) => { e.stopPropagation(); toggleHelp(helpTooltip.style.display !== 'block'); });
  if (closeHelpTooltip) closeHelpTooltip.addEventListener('click', () => toggleHelp(false));


  // Global click listener to hide menus/tooltips
  document.addEventListener('click', function(e) {
    if (nodeMenu) nodeMenu.style.display = 'none';
    // If help is open and click is outside, close it
    if (helpTooltip && helpTooltip.style.display === 'block' && !helpTooltip.contains(e.target) && e.target !== helpButton) {
        // toggleHelp(false); // This line was causing issues with the help button itself.
    }
  });
  
  // Export JSON
  if (exportJSONBtn) exportJSONBtn.addEventListener('click', function() {
      showLoading(true);
      try {
        const json = JSON.stringify(window.moduleInfo || {}, null, 2);
        const blob = new Blob([json], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'model_info.json';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url); // Clean up
        showNotification('Model data exported as JSON.', 'success');
      } catch (err) {
        console.error('Failed to export JSON:', err);
        showNotification('Error exporting JSON.', 'error');
      } finally {
        showLoading(false);
      }
  });
  
  // Function to get all descendant nodes (recursively)
  function getAllDescendantNodes(parentNodePath) {
      if (!svgElement || !parentNodePath) return [];
      return Array.from(svgElement.querySelectorAll('[data-name]')).filter(n => {
          const path = n.getAttribute('data-name');
          return path && path !== parentNodePath && path.startsWith(parentNodePath + '.');
      });
  }

  // Function to get direct child nodes
  function getDirectChildNodes(parentNodePath) {
      if (!svgElement || !parentNodePath) return [];
      return Array.from(svgElement.querySelectorAll('[data-name]')).filter(n => {
          const path = n.getAttribute('data-name');
          if (!path || path === parentNodePath || !path.startsWith(parentNodePath + '.')) return false;
          // A direct child's path should be parentNodePath.childName (no further dots)
          const remainder = path.substring(parentNodePath.length + 1);
          return remainder.indexOf('.') === -1;
      });
  }
  
  // Function to toggle node collapse state
  function toggleNodeCollapse(nodeToToggle, collapse, forceRecursive = false) {
      const modulePath = nodeToToggle.getAttribute('data-name');
      if (!modulePath) return;

      const directChildren = getDirectChildNodes(modulePath);

      if (collapse) {
          nodeToToggle.classList.add('collapsed-node');
          collapsedNodes.add(modulePath);
          directChildren.forEach(child => {
              child.classList.add('hidden-node');
              // If recursively collapsing, also hide children of children
              if (forceRecursive || collapsedNodes.has(child.getAttribute('data-name'))) {
                 getAllDescendantNodes(child.getAttribute('data-name')).forEach(n => n.classList.add('hidden-node'));
              }
          });
      } else {
          nodeToToggle.classList.remove('collapsed-node');
          collapsedNodes.delete(modulePath);
          directChildren.forEach(child => {
              child.classList.remove('hidden-node');
              // If this child itself was collapsed, don't expand its children unless explicitly told to
              if (!collapsedNodes.has(child.getAttribute('data-name'))) {
                  // This logic ensures that expanding a parent doesn't auto-expand a child that was individually collapsed.
                  // To show children of this child, they must not be hidden due to their own parent being collapsed.
                  const grandChildren = getDirectChildNodes(child.getAttribute('data-name'));
                  grandChildren.forEach(gc => {
                      if (!collapsedNodes.has(child.getAttribute('data-name'))) { // only show if immediate parent is now expanded
                           gc.classList.remove('hidden-node');
                      }
                  });
              }
          });
      }
      updateNodeExpansionIndicator(nodeToToggle);
  }

  function updateNodeExpansionIndicator(node) {
    const indicator = node.querySelector('.expansion-indicator');
    if (indicator) {
        indicator.textContent = collapsedNodes.has(node.getAttribute('data-name')) ? '+' : '-';
    }
  }
  
  // Add handlers to all potential nodes
  function setupNodeInteractions() {
    if (!svgElement) return;
    showLoading(true); // Show loading before processing nodes

    const allGraphNodes = svgElement.querySelectorAll('g[id^="node_"]');
    allGraphNodes.forEach(node => {
        const modulePath = node.getAttribute('data-name');
        if (!modulePath) {
            // console.warn('Node found without data-name:', node.id);
            return; // Skip nodes without a data-name, they are not part of the module tree
        }

        // Add expansion indicator if it has children
        const directChildren = getDirectChildNodes(modulePath);
        if (directChildren.length > 0) {
            let indicator = node.querySelector('.expansion-indicator');
            if (!indicator) {
                const textElement = node.querySelector('text'); // Assuming text exists for label
                if (textElement) {
                    indicator = document.createElementNS("http://www.w3.org/2000/svg", "text");
                    indicator.setAttribute('class', 'expansion-indicator');
                    // Position relative to the existing text or a corner of the node
                    // This might need adjustment based on your node's SVG structure
                    const bbox = textElement.getBBox ? textElement.getBBox() : { x: 0, y: 0, width: 0, height: 0 };
                    indicator.setAttribute('x', bbox.x - 10); // Example positioning
                    indicator.setAttribute('y', bbox.y + bbox.height / 2 + 5); // Adjust as needed
                    indicator.style.cursor = 'pointer';
                    indicator.style.fontSize = '16px'; // Make it more visible
                    indicator.style.fontWeight = 'bold';
                    node.appendChild(indicator);
                }
            }
            if (indicator) {
                 indicator.textContent = collapsedNodes.has(modulePath) ? '+' : '-';
            }
        }


        node.style.cursor = 'pointer';
        
        // Double-click to collapse/expand
        node.addEventListener('dblclick', function(e) {
            e.stopPropagation();
            const currentModulePath = this.getAttribute('data-name');
            if (!currentModulePath) return;
            const isCollapsed = collapsedNodes.has(currentModulePath);
            toggleNodeCollapse(this, !isCollapsed);
        });
        
        // Single-click to show info and highlight
        node.addEventListener('click', function(e) {
            e.stopPropagation();
            const currentModulePath = this.getAttribute('data-name');
            if (!currentModulePath) return;
            
            displayModuleInfo(currentModulePath);
            
            allGraphNodes.forEach(n => n.classList.remove('highlight-node'));
            this.classList.add('highlight-node');
        });
        
        // Context menu
        node.addEventListener('contextmenu', function(e) {
            e.preventDefault();
            e.stopPropagation();
            const currentModulePath = this.getAttribute('data-name');
            if (!currentModulePath) return;

            nodeMenu.style.display = 'block';
            nodeMenu.style.left = `${e.pageX}px`;
            nodeMenu.style.top = `${e.pageY}px`;
            nodeMenu.setAttribute('aria-hidden', 'false');
            
            // Update context menu items based on the node
            document.getElementById('copyName').onclick = (ev) => { ev.stopPropagation(); copyModuleName(currentModulePath); nodeMenu.style.display = 'none'; };
            document.getElementById('showDetails').onclick = (ev) => { ev.stopPropagation(); displayModuleInfo(currentModulePath); nodeMenu.style.display = 'none'; };
            document.getElementById('highlightPath').onclick = (ev) => { ev.stopPropagation(); highlightModulePath(currentModulePath); nodeMenu.style.display = 'none'; };
            
            const toggleCollapseItem = document.getElementById('toggleCollapse');
            const isNodeCollapsed = collapsedNodes.has(currentModulePath);
            toggleCollapseItem.textContent = isNodeCollapsed ? 'Expand Node' : 'Collapse Node';
            toggleCollapseItem.onclick = (ev) => {
                ev.stopPropagation();
                toggleNodeCollapse(this, !isNodeCollapsed);
                nodeMenu.style.display = 'none';
            };
        });

        // Make nodes draggable (Alt + Drag or Middle Mouse Drag)
        makeNodeDraggable(node);

        // Apply initially collapsed state if needed (e.g. after search or full collapse)
        if (collapsedNodes.has(modulePath) && !node.classList.contains('collapsed-node')) {
            toggleNodeCollapse(node, true, true); // force recursive hide
        } else if (!collapsedNodes.has(modulePath) && node.classList.contains('collapsed-node')) {
            // This case should ideally not happen if state is consistent
            node.classList.remove('collapsed-node');
        }
        updateNodeExpansionIndicator(node);
    });
    showLoading(false); // Hide loading after processing
  }
  
  // Call setupNodeInteractions once SVG is ready
  if (svgElement) {
      // If SVG is complex, defer to allow rendering first
      setTimeout(setupNodeInteractions, 100);
  }


  function copyModuleName(moduleName) {
    navigator.clipboard.writeText(moduleName).then(() => {
        showNotification(`Module name "${moduleName}" copied!`, 'success');
    }).catch(err => {
        console.error('Failed to copy module name: ', err);
        showNotification('Error copying name.', 'error');
    });
  }

  function highlightModulePath(moduleName) {
    if (!svgElement) return;
    const allGraphNodes = svgElement.querySelectorAll('g[id^="node_"]');
    allGraphNodes.forEach(n => n.classList.add('fade'));
    
    const parts = moduleName.split('.');
    let currentPath = '';
    for (let i = 0; i < parts.length; i++) {
        currentPath = i === 0 ? parts[i] : `${currentPath}.${parts[i]}`;
        const nodeToHighlight = svgElement.querySelector(`g[data-name="${currentPath}"]`);
        if (nodeToHighlight) {
            nodeToHighlight.classList.remove('fade');
            nodeToHighlight.classList.add('highlight-path-segment'); // For distinct path highlight
        }
    }
    
    setTimeout(() => { 
        allGraphNodes.forEach(n => {
            n.classList.remove('fade');
            n.classList.remove('highlight-path-segment');
        });
    }, 3000);
  }

  function makeNodeDraggable(nodeEl) {
      let isDragging = false;
      let dragOffsetX, dragOffsetY;
      let originalTransform = '';

      nodeEl.addEventListener('mousedown', function(e) {
          if (e.altKey || e.button === 1) { // Alt key or Middle mouse button
              e.stopPropagation(); // Prevent pan if svg-pan-zoom is active
              
              isDragging = true;
              nodeEl.classList.add('dragging');
              originalTransform = nodeEl.getAttribute('transform') || '';
              
              // Get initial mouse position relative to SVG viewport
              const CTM = svgElement.getScreenCTM();
              const initialMouseX = (e.clientX - CTM.e) / CTM.a;
              const initialMouseY = (e.clientY - CTM.f) / CTM.d;

              // Get current translation of the node
              let currentTranslateX = 0, currentTranslateY = 0;
              const transformMatch = originalTransform.match(/translate\s*\(([^,\s]+)[,\s]+([^\)]+)\)/);
              if (transformMatch) {
                  currentTranslateX = parseFloat(transformMatch[1]);
                  currentTranslateY = parseFloat(transformMatch[2]);
              }
              
              dragOffsetX = initialMouseX - currentTranslateX;
              dragOffsetY = initialMouseY - currentTranslateY;
              
              // Bring to front
              nodeEl.parentNode.appendChild(nodeEl);
              if(svgPanZoomInstance) svgPanZoomInstance.disablePan(); // Disable pan while dragging node
          }
      });

      document.addEventListener('mousemove', function(e) { // Listen on document for wider drag area
          if (isDragging) {
              e.preventDefault();
              const CTM = svgElement.getScreenCTM();
              const mouseX = (e.clientX - CTM.e) / CTM.a;
              const mouseY = (e.clientY - CTM.f) / CTM.d;
              
              const newTranslateX = mouseX - dragOffsetX;
              const newTranslateY = mouseY - dragOffsetY;
              
              nodeEl.setAttribute('transform', `translate(${newTranslateX}, ${newTranslateY})`);
              updateEdges(nodeEl, newTranslateX, newTranslateY);
          }
      });

      document.addEventListener('mouseup', function() {
          if (isDragging) {
              isDragging = false;
              nodeEl.classList.remove('dragging');
              if(svgPanZoomInstance) svgPanZoomInstance.enablePan();
          }
      });
  }
  
  // Basic edge update (highly dependent on Graphviz output structure)
  // This is a placeholder and likely needs significant refinement based on actual SVG structure of edges.
  function updateEdges(node, newTranslateX, newTranslateY) {
    if (!svgElement) return;
    const nodeId = node.getAttribute('id'); // Assumes node has an ID used by edges
    if (!nodeId) return;

    // This is a very simplified example. Edges in Graphviz are complex.
    // It's often better to re-render with Graphviz if dynamic edge updates are critical and complex.
    // Or, use a JS graph library that handles this.

    // Find edges connected to this node (data-source or data-target attributes were added in Python)
    const edges = svgElement.querySelectorAll(`path[data-source="${nodeId}"], path[data-target="${nodeId}"]`);
    
    edges.forEach(edge => {
        // Graphviz edges are paths. Their 'd' attribute defines the line.
        // Updating these correctly without knowing the exact start/end points relative
        // to the node's new position is very hard.
        // A common approach is to find the control points of the path and adjust them.
        // However, Graphviz's path 'd' attribute can be complex (e.g., splines).

        // For a very simple line, you might parse 'd', find M (moveto) and L (lineto)
        // and adjust. But this won't work for splines (C, S commands).
    });
  }
  
  // Collapse/Expand All
  if (expandAllBtn) expandAllBtn.addEventListener('click', function() {
      showLoading(true);
      if (!svgElement) { showLoading(false); return; }
      const allGraphNodes = svgElement.querySelectorAll('g[id^="node_"]');
      allGraphNodes.forEach(node => {
          const nodePath = node.getAttribute('data-name');
          if (nodePath && collapsedNodes.has(nodePath)) { // Only expand if it was collapsed
            toggleNodeCollapse(node, false);
          }
          node.classList.remove('hidden-node'); // Ensure all are visible
      });
      collapsedNodes.clear(); // All are now expanded
      allGraphNodes.forEach(node => updateNodeExpansionIndicator(node));
      showNotification('All nodes expanded.', 'info');
      showLoading(false);
  });
  
  if (collapseAllBtn) collapseAllBtn.addEventListener('click', function() {
      showLoading(true);
      if (!svgElement) { showLoading(false); return; }
      const allGraphNodes = svgElement.querySelectorAll('g[id^="node_"]');
      // Collapse all nodes that have children, starting from top-level
      const topLevelNodes = Array.from(allGraphNodes).filter(node => {
          const path = node.getAttribute('data-name');
          // A top-level node in the context of the graph is one whose data-name does not contain '.'
          // or it's the special 'root' node.
          return path && (path === 'root' || !path.includes('.'));
      });

      topLevelNodes.forEach(node => {
          const modulePath = node.getAttribute('data-name');
          if (getDirectChildNodes(modulePath).length > 0) { // Only collapse if it has children
            toggleNodeCollapse(node, true, true); // true for recursive collapse
          }
      });
      // Any node that is not a top-level but has children and is not already part of a collapsed parent path
      // should also be marked as collapsed if we want a "full" collapse.
      // For now, collapsing top-level recursively should handle most cases.
      allGraphNodes.forEach(node => updateNodeExpansionIndicator(node));
      showNotification('All expandable nodes collapsed.', 'info');
      showLoading(false);
  });
  
  // Function to display module information
  function displayModuleInfo(moduleName) {
      const info = window.moduleInfo ? window.moduleInfo[moduleName] : null;
      if (!infoPanel) return;

      if (!info) {
          infoPanel.innerHTML = `<h3 id="infoPanelHeader">Module: ${moduleName}</h3><p>No detailed information available.</p>`;
          return;
      }
      let html = `<h3 id="infoPanelHeader">Module: ${moduleName}</h3>`;
      html += `<div class="layer-path" lang="en" dir="ltr">${moduleName}</div>`; // Added lang/dir for accessibility
      html += `<button id="copyNameBtnInfoPanel" class="info-panel-button" style="margin-bottom:8px;">Copy Full Name</button>`;
      html += `<table aria-labelledby="infoPanelHeader">`; // Aria for table context
      html += `<thead><tr><th scope="col">Property</th><th scope="col">Value</th></tr></thead>`;
      html += `<tbody>`;
      html += `<tr><th scope="row">Type</th><td>${info.type || 'N/A'}</td></tr>`;
      html += `<tr><th scope="row">Parameters</th><td>${info.parameters?.toLocaleString() || '0'}</td></tr>`;
      html += `<tr><th scope="row">Trainable</th><td>${info.trainable ? 'Yes' : 'No'}</td></tr>`;
      html += `<tr><th scope="row">Class</th><td><code lang="en">${info.class || 'N/A'}</code></td></tr>`;
      html += `<tr><th scope="row">Docstring</th><td>${info.docstring || 'N/A'}</td></tr>`;
      
      for (const [key, value] of Object.entries(info)) {
          if (!['type', 'parameters', 'trainable', 'class', 'docstring'].includes(key)) {
              html += `<tr><th scope="row">${key.charAt(0).toUpperCase() + key.slice(1)}</th><td>${JSON.stringify(value)}</td></tr>`;
          }
      }
      html += `</tbody></table>`;
      infoPanel.innerHTML = html;
      
      const copyBtnInfo = document.getElementById('copyNameBtnInfoPanel');
      if (copyBtnInfo) {
          copyBtnInfo.onclick = function() {
              copyModuleName(moduleName);
          };
      }
  }
  
  // Enhanced search
  if (searchInput) searchInput.addEventListener('input', function() {
    const searchTerm = this.value.trim().toLowerCase();
    const allGraphNodes = svgElement ? svgElement.querySelectorAll('g[id^="node_"]') : [];

    if (searchTerm === '') {
        allGraphNodes.forEach(node => {
            node.style.opacity = 1;
            node.classList.remove('hidden-by-search');
            // Restore visibility based on collapsed state, not just make all visible
            const modulePath = node.getAttribute('data-name');
            if (modulePath) {
                const isHiddenByCollapse = Array.from(collapsedNodes).some(collapsedParentPath => 
                    modulePath.startsWith(collapsedParentPath + '.') && modulePath !== collapsedParentPath
                );
                if (isHiddenByCollapse) {
                    node.classList.add('hidden-node');
                }
            }
        });
        return;
    }

    // Determine if we're using a special filter syntax (key:value)
    const isSpecialFilter = searchTerm.includes(':');
    let filterKey, filterValue;
    
    if (isSpecialFilter) {
        const parts = searchTerm.split(':');
        filterKey = parts[0].trim();
        filterValue = parts.slice(1).join(':').trim(); // In case value contains colons too
    }

    // Search in moduleInfo data (if available) and highlight matching nodes
    const moduleInfoData = window.moduleInfo || {};
    
    allGraphNodes.forEach(node => {
        const modulePath = node.getAttribute('data-name');
        if (!modulePath) {
            node.classList.add('hidden-by-search');
            return;
        }
        
        // Default to hiding
        node.classList.add('hidden-by-search');
        node.style.opacity = 0.3;
        
        // Special filter handling
        if (isSpecialFilter) {
            const moduleData = moduleInfoData[modulePath];
            if (!moduleData) return; // No data to filter on
            
            // Handle different filter types
            let matchesFilter = false;
            
            switch(filterKey) {
                case 'type':
                    matchesFilter = moduleData.type && moduleData.type.toLowerCase().includes(filterValue);
                    break;
                case 'trainable':
                    matchesFilter = 
                        (filterValue === 'yes' && moduleData.trainable) || 
                        (filterValue === 'no' && !moduleData.trainable);
                    break;
                case 'params':
                case 'parameters':
                    if (filterValue.startsWith('>')) {
                        const threshold = parseInt(filterValue.substring(1).trim());
                        matchesFilter = !isNaN(threshold) && moduleData.parameters > threshold;
                    } else if (filterValue.startsWith('<')) {
                        const threshold = parseInt(filterValue.substring(1).trim());
                        matchesFilter = !isNaN(threshold) && moduleData.parameters < threshold;
                    } else {
                        const exactValue = parseInt(filterValue);
                        matchesFilter = !isNaN(exactValue) && moduleData.parameters === exactValue;
                    }
                    break;
                default:
                    // Try to match against any property
                    for (const [key, value] of Object.entries(moduleData)) {
                        if (
                            (key.toLowerCase() === filterKey && 
                             String(value).toLowerCase().includes(filterValue)) || 
                            (String(value).toLowerCase().includes(searchTerm))
                        ) {
                            matchesFilter = true;
                            break;
                        }
                    }
            }
            
            if (matchesFilter) {
                node.classList.remove('hidden-by-search');
                node.style.opacity = 1;
                // Also show all parent nodes in the path
                const parts = modulePath.split('.');
                let currentPath = '';
                for (let i = 0; i < parts.length; i++) {
                    currentPath = i === 0 ? parts[i] : `${currentPath}.${parts[i]}`;
                    const parentNode = svgElement.querySelector(`g[data-name="${currentPath}"]`);
                    if (parentNode) {
                        parentNode.classList.remove('hidden-by-search');
                        parentNode.style.opacity = 1;
                        // Ensure parent nodes are expanded
                        if (collapsedNodes.has(currentPath)) {
                            toggleNodeCollapse(parentNode, false);
                        }
                    }
                }
            }
            
        } else {
            // Simple name search
            if (modulePath.toLowerCase().includes(searchTerm)) {
                node.classList.remove('hidden-by-search');
                node.style.opacity = 1;
                
                // Make sure parents are visible and expanded
                const parts = modulePath.split('.');
                let currentPath = '';
                for (let i = 0; i < parts.length; i++) {
                    currentPath = i === 0 ? parts[i] : `${currentPath}.${parts[i]}`;
                    const parentNode = svgElement.querySelector(`g[data-name="${currentPath}"]`);
                    if (parentNode && parentNode !== node) {
                        parentNode.classList.remove('hidden-by-search');
                        parentNode.style.opacity = 1;
                        
                        // Expand parent if collapsed
                        if (collapsedNodes.has(currentPath)) {
                            toggleNodeCollapse(parentNode, false);
                        }
                    }
                }
            }
        }
    });
  });

  // Search clearing
  if (clearSearch) clearSearch.addEventListener('click', function() {
    if (searchInput) searchInput.value = '';
    // Trigger the input event to clear search results
    const event = new Event('input', { bubbles: true });
    searchInput.dispatchEvent(event);
    searchInput.focus();
  });

  // Keyboard shortcuts
  document.addEventListener('keydown', function(e) {
    // Focus search with Ctrl+F
    if ((e.ctrlKey || e.metaKey) && e.key === 'f') {
        e.preventDefault(); // Prevent browser's find
        searchInput.focus();
    }
    
    // Clear search with Escape
    if (e.key === 'Escape') {
        if (searchInput && document.activeElement === searchInput) {
            searchInput.value = '';
            const event = new Event('input', { bubbles: true });
            searchInput.dispatchEvent(event);
        } else if (helpTooltip && helpTooltip.style.display === 'block') {
            toggleHelp(false);
        }
    }
    
    // Show help with ? or Ctrl+H
    if (e.key === '?' || ((e.ctrlKey || e.metaKey) && e.key === 'h')) {
        e.preventDefault();
        toggleHelp(helpTooltip.style.display !== 'block');
    }
  });

  // SVG-pan-zoom keyboard handlers
  document.addEventListener('keydown', function(e) {
      if (!svgPanZoomInstance) return;
      
      // Zoom with + and -
      if (e.key === '+' || e.key === '=') {
          svgPanZoomInstance.zoomIn();
      }
      if (e.key === '-' || e.key === '_') {
          svgPanZoomInstance.zoomOut();
      }
      // Reset with 0
      if (e.key === '0') {
          svgPanZoomInstance.resetZoom();
      }
  });
  
  // Make resize handle functional
  if (resizeHandle && visualizationContainer) {
      let startY, startHeight;
      
      resizeHandle.addEventListener('mousedown', function(e) {
          startY = e.clientY;
          startHeight = parseInt(document.defaultView.getComputedStyle(visualizationContainer).height, 10);
          document.documentElement.addEventListener('mousemove', doDrag, false);
          document.documentElement.addEventListener('mouseup', stopDrag, false);
      });
      
      function doDrag(e) {
          visualizationContainer.style.height = (startHeight + e.clientY - startY) + 'px';
      }
      
      function stopDrag() {
          document.documentElement.removeEventListener('mousemove', doDrag, false);
          document.documentElement.removeEventListener('mouseup', stopDrag, false);
          // After resize, make sure SVG pan-zoom instance is updated
          if (svgPanZoomInstance) {
              svgPanZoomInstance.resize();
              svgPanZoomInstance.fit();
              svgPanZoomInstance.center();
          }
      }
  }
  
  // Load svg-pan-zoom library dynamically if not available
  if (!window.svgPanZoom && svgElement) {
      const script = document.createElement('script');
      script.src = 'https://cdn.jsdelivr.net/npm/svg-pan-zoom@3.6.1/dist/svg-pan-zoom.min.js';
      script.onload = function() {
          console.log('svg-pan-zoom library loaded dynamically');
          initSvgPanZoom();
      };
      document.head.appendChild(script);
  }
});
    </script>
</body>
</html>